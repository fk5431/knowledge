M.define("/js/Dropdown",function(c,b,d){function a(e){this.$nav=typeof e.nav==="string"?$(e.nav):e.nav;this.$panel=typeof e.panel==="string"?$(e.panel):e.panel;this.showCallback=e.showCallback;this.hideCallback=e.hideCallback;this.delay=e.delay||0;this.event=e.event||"mouseenterleave";this._isShow=false;this.init()}a.prototype={init:function(){if(this.event==="mouseenterleave"){this.$nav.on("mouseenter.dropdown",M.bind(function(e){this.show()},this)).on("mouseleave.dropdown",M.bind(function(e){if($(e.relatedTarget).closest(this.$panel).length===0){this.hide(true)}},this));this.$panel.on("mouseenter.dropdown",M.bind(function(e){this.show()},this)).on("mouseleave.dropdown",M.bind(function(e){if($(e.relatedTarget).closest(this.$nav).length===0){this.hide(false)}},this))}if(this.event==="click"){this.$nav.on("click.dropdown",M.bind(function(e){this.show()},this));$(document).on("click.dropdown",M.bind(function(e){if($(e.target).closest(this.$nav).length===0&&$(e.target).closest(this.$panel).length===0){this.hide(false)}},this))}},show:function(){this.$panel.show();this._isShow=true;if(M.isFunction(this.showCallback)){this.showCallback.call(this,this.$nav,this.$panel)}},hide:function(e){this._isShow=false;if(e&&this.delay>0){setTimeout(M.bind(function(){if(!this._isShow){this.$panel.hide();if(M.isFunction(this.hideCallback)){this.hideCallback.call(this,this.$nav,this.$panel)}}},this),this.delay)}else{this.$panel.hide();if(M.isFunction(this.hideCallback)){this.hideCallback.call(this,this.$nav,this.$panel)}}},destory:function(){if(this.event==="mouseenterleave"){this.$nav.off("mouseenter.dropdown").off("mouseleave.dropdown");this.$panel.off("mouseenter.dropdown").off("mouseleave.dropdown")}if(this.event==="click"){this.$nav.off("click.dropdown")}this.$panel.hide()}};d.exports=a});M.define("/js/pageletcommon/pageHeadUserInfoWWWNormal",function(c){var a=c("/js/Dropdown"),b=window.Env||{};return{events:{},init:function(){var k=$("#head-btn-daka");$(function(){$(".new_daka_tips").addClass("on")});$(".ndt_close").on("click",function(){$(this).parent().hide()});M.Event.on("afterDaka",l);function l(q){if(q&&q.dakaFlag){k.closest(".head-daka").addClass("daka-complete")}}var e=i("dakaday");if(e!==null){$(".head-btn-daka").attr("data-day",e)}function i(q){var s=new RegExp("(^|&)"+q+"=([^&]*)(&|$)");var t=window.location.search.substr(1).match(s);if(t!==null){return unescape(t[2])}return null}var g=new a({nav:"#_j_head_user",panel:"#_j_user_panel",showCallback:function(q,r){q.find(".drop-trigger").addClass("drop-trigger-active")},hideCallback:function(q,r){q.find(".drop-trigger").removeClass("drop-trigger-active")},delay:500});var d=0,p=$("#_j_head_msg"),o=$("#_j_msg_panel"),n=p.find(".head-msg-new"),j=$("#_j_msg_float_panel");var f=new a({nav:p.selector,panel:o.selector,showCallback:function(q,r){q.find(".drop-trigger").addClass("drop-trigger-active")},hideCallback:function(q,r){q.find(".drop-trigger").removeClass("drop-trigger-active")},delay:200});M.Event.on("get new msg",function(q){if(q.msg||d>0){o.find("ul").html(q.menu_index);h()}});o.on("click","a",function(q){M.Event.fire("update msg")});j.on("click","ul a",function(q){M.Event.fire("update msg")});j.on("click",".close-newmsg",function(q){m()});function m(){n.hide();j.hide();$.ajax({url:"http://"+b.WWW_HOST+"/ajax/ajax_msg.php",dataType:"jsonp",data:{a:"ignore",from:"1"},success:function(q){M.Event.fire("update msg")}})}window.close_msg_tips=m;function h(){var q="";d=0;o.find(".num").each(function(r,t){var s=$(t);d+=Number(s.html());q+="<li>"+s.closest("li").html()+"</li>"});if(d>0){n.html((d>99?"99+":d)).show();j.find("ul").html(q).end().show()}else{n.hide();j.hide()}}h()}}});
/*!
 * jQuery Templates Plugin 1.0.0pre
 * http://github.com/jquery/jquery-tmpl
 * Requires jQuery 1.4.2
 *
 * Copyright 2011, Software Freedom Conservancy, Inc.
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 */
(function(i,f){var t=i.fn.domManip,h="_tmplitem",u=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,p={},e={},y,x={key:0,data:{}},w=0,q=0,g=[];function k(B,A,D,E){var C={data:E||(E===0||E===false)?E:(A?A.data:{}),_wrap:A?A._wrap:null,tmpl:null,parent:A||null,nodes:[],calls:c,nest:b,wrap:n,html:r,update:z};if(B){i.extend(C,B,{nodes:[],parent:A})}if(D){C.tmpl=D;C._ctnt=C._ctnt||C.tmpl(i,C);C.key=++w;(g.length?e:p)[w]=C}return C}i.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(A,B){i.fn[A]=function(C){var F=[],I=i(C),E,G,D,J,H=this.length===1&&this[0].parentNode;y=p||{};if(H&&H.nodeType===11&&H.childNodes.length===1&&I.length===1){I[B](this[0]);F=this}else{for(G=0,D=I.length;G<D;G++){q=G;E=(G>0?this.clone(true):this).get();i(I[G])[B](E);F=F.concat(E)}q=0;F=this.pushStack(F,A,I.selector)}J=y;y=null;i.tmpl.complete(J);return F}});i.fn.extend({tmpl:function(C,B,A){return i.tmpl(this[0],C,B,A)},tmplItem:function(){return i.tmplItem(this[0])},template:function(A){return i.template(A,this[0])},domManip:function(E,H,G,I){if(E[0]&&i.isArray(E[0])){var B=i.makeArray(arguments),A=E[0],F=A.length,C=0,D;while(C<F&&!(D=i.data(A[C++],"tmplItem"))){}if(D&&q){B[2]=function(J){i.tmpl.afterManip(this,J,G)}}t.apply(this,B)}else{t.apply(this,arguments)}q=0;if(!y){i.tmpl.complete(p)}return this}});i.extend({tmpl:function(C,F,E,B){var D,A=!B;if(A){B=x;C=i.template[C]||i.template(null,C);e={}}else{if(!C){C=B.tmpl;p[B.key]=B;B.nodes=[];if(B.wrapped){s(B,B.wrapped)}return i(m(B,null,B.tmpl(i,B)))}}if(!C){return[]}if(typeof F==="function"){F=F.call(B||{})}if(E&&E.wrapped){s(E,E.wrapped)}D=i.isArray(F)?i.map(F,function(G){return G?k(E,B,C,G):null}):[k(E,B,C,F)];return A?i(m(B,null,D)):D},tmplItem:function(B){var A;if(B instanceof i){B=B[0]}while(B&&B.nodeType===1&&!(A=i.data(B,"tmplItem"))&&(B=B.parentNode)){}return A||x},template:function(B,A){if(A){if(typeof A==="string"){A=l(A)}else{if(A instanceof i){A=A[0]||{}}}if(A.nodeType){A=i.data(A,"tmpl")||i.data(A,"tmpl",l(A.innerHTML))}return typeof B==="string"?(i.template[B]=A):A}return B?(typeof B!=="string"?i.template(null,B):(i.template[B]||i.template(null,u.test(B)?B:i(B)))):null},encode:function(A){return(""+A).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});i.extend(i.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(A){p={}},afterManip:function v(C,A,D){var B=A.nodeType===11?i.makeArray(A.childNodes):A.nodeType===1?[A]:[];D.call(C,A);o(B);q++}});function m(A,E,C){var D,B=C?i.map(C,function(F){return(typeof F==="string")?(A.key?F.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+h+'="'+A.key+'" $2'):F):m(F,A,F._ctnt)}):A;if(E){return B}B=B.join("");B.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(G,H,F,I){D=i(F).get();o(D);if(H){D=a(H).concat(D)}if(I){D=D.concat(a(I))}});return D?D:a(B)}function a(B){var A=document.createElement("div");A.innerHTML=B;return i.makeArray(A.childNodes)}function l(A){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+i.trim(A).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(I,C,G,D,E,J,F){var L=i.tmpl.tag[G],B,H,K;if(!L){throw"Unknown template tag: "+G}B=L._default||[];if(J&&!/\w$/.test(E)){E+=J;J=""}if(E){E=j(E);F=F?(","+j(F)+")"):(J?")":"");H=J?(E.indexOf(".")>-1?E+j(J):("("+E+").call($item"+F)):E;K=J?H:"(typeof("+E+")==='function'?("+E+").call($item):("+E+"))"}else{K=H=B.$1||"null"}D=j(D);return"');"+L[C?"close":"open"].split("$notnull_1").join(E?"typeof("+E+")!=='undefined' && ("+E+")!=null":"true").split("$1a").join(K).split("$1").join(H).split("$2").join(D||B.$2||"")+"__.push('"})+"');}return __;")}function s(B,A){B._wrap=m(B,true,i.isArray(A)?A:[u.test(A)?A:i(A).html()]).join("")}function j(A){return A?A.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function d(A){var B=document.createElement("div");B.appendChild(A.cloneNode(true));return B.innerHTML}function o(G){var I="_"+q,B,A,E={},F,D,C;for(F=0,D=G.length;F<D;F++){if((B=G[F]).nodeType!==1){continue}A=B.getElementsByTagName("*");for(C=A.length-1;C>=0;C--){H(A[C])}H(B)}function H(P){var L,O=P,N,J,K;if((K=P.getAttribute(h))){while(O.parentNode&&(O=O.parentNode).nodeType===1&&!(L=O.getAttribute(h))){}if(L!==K){O=O.parentNode?(O.nodeType===11?0:(O.getAttribute(h)||0)):0;if(!(J=p[K])){J=e[K];J=k(J,p[O]||e[O]);J.key=++w;p[w]=J}if(q){Q(K)}}P.removeAttribute(h)}else{if(q&&(J=i.data(P,"tmplItem"))){Q(J.key);p[J.key]=J;O=i.data(P.parentNode,"tmplItem");O=O?O.key:0}}if(J){N=J;while(N&&N.key!=O){N.nodes.push(P);N=N.parent}delete J._ctnt;delete J._wrap;i.data(P,"tmplItem",J)}function Q(R){R=R+I;J=E[R]=(E[R]||k(J,p[J.parent.key+I]||J.parent))}}}function c(C,A,D,B){if(!C){return g.pop()}g.push({_:C,tmpl:A,item:this,data:D,options:B})}function b(A,C,B){return i.tmpl(i.template(A),C,B,this)}function n(C,A){var B=C.options||{};B.wrapped=A;return i.tmpl(i.template(C.tmpl),C.data,B,C.item)}function r(B,C){var A=this._wrap;return i.map(i(i.isArray(A)?A.join(""):A).filter(B||"*"),function(D){return C?D.innerText||D.textContent:D.outerHTML||d(D)})}function z(){var A=this.nodes;i.tmpl(null,null,null,this).insertBefore(A[0]);i(A).remove()}if(window.M&&typeof M.define=="function"){M.define("jq-tmpl",function(){return i})}})(jQuery);M.define("InputListener",function(c,b,d){var a={listen:function(f,e){f=$(f);f.each($.proxy(function(g,h){h=$(h);if(!h.is("input")&&!h.is("textarea")){throw new Error("input listener only apply to input or textarea")}this.initListen(h,e)},this))},unlisten:function(e){e=$(e);e.each($.proxy(function(h,k){k=$(k);if(!k.is("input")&&!k.is("textarea")){throw new Error("input listener only apply to input or textarea")}if(arguments.length==1){k.unbind("focus",this.getStartListenFunc());k.unbind("blur",this.getStopListenFunc());k.removeData("__input_listener_handlers")}else{if(typeof arguments[1]=="function"){var j=arguments[1],g=k.data("__input_listener_listeninterval");for(var h=0,f=g.length;h<f;h++){if(g[h]==j){g.splice(h,1);h--}}}}},this))},initListen:function(f,e){f.data("__input_listener_currentval",f.val());if(!f.data("__input_listener_handlers")){this.bindListenEvent(f)}this.addListenHandler(f,e);if(f.is(":focus")){f.blur();f.focus()}},bindListenEvent:function(e){e.data("__input_listener_handlers",[]);e.focus(this.getStartListenFunc());e.blur(this.getStopListenFunc())},getStartListenFunc:function(){if(!this.bindStartListenFunc){this.bindStartListenFunc=$.proxy(this.startListen,this)}return this.bindStartListenFunc},getStopListenFunc:function(){if(!this.bindStopListenFunc){this.bindStopListenFunc=$.proxy(this.stopListen,this)}return this.bindStopListenFunc},startListen:function(e){var f=$(e.target);f.data("__input_listener_currentval",f.val());f.data("__input_listener_listeninterval",setInterval($.proxy(function(){var h=f.data("__input_listener_currentval"),g=f.val();if(h!=g){f.data("__input_listener_currentval",g);this.triggerListenHandler(f)}},this),100))},stopListen:function(e){var f=$(e.target);clearInterval(f.data("__input_listener_listeninterval"))},addListenHandler:function(f,e){if(typeof e=="function"){f.data("__input_listener_handlers").push(e)}},triggerListenHandler:function(h){var f=h.data("__input_listener_handlers");for(var g=0,e=f.length;g<e;g++){f[g].call(null,{target:h.get(0)})}}};return a});M.define("SuggestionXHR",function(b,a,c){function d(e){this.URL=null;this.delay=200;this.dataType="text";$.extend(this,e);this.delayTimer=null;this.xhr=null;this.cache={};this.init()}d.prototype={init:function(){if(!this.URL){throw new Error("no url for suggestion")}},getSuggestion:function(g,h){var f=this.getQuery(g),e=this.cache[f];h=typeof h==="function"?h:$.noop;this.stop();if(e){h(e)}else{this.getXHRData(f,h)}},stop:function(){clearTimeout(this.delayTimer);if(this.xhr&&this.xhr.readyState!==4){this.xhr.abort()}},getQuery:function(h){var g="";if(typeof h=="string"){g=encodeURIComponent(h)}else{if(h&&typeof h=="object"){var e=[];for(var f in h){if(h.hasOwnProperty(f)){e.push(f+"="+encodeURIComponent(h[f]))}}g=e.join("&")}}return g},getXHRData:function(e,h){var f=this.xhr,g={url:this.URL,data:e,dataType:this.dataType,success:M.bind(function(i){h(i);this.cache[e]=i},this)};this.delayTimer=setTimeout(M.bind(function(){this.xhr=$.ajax(g)},this),this.delay)}};return d});M.define("DropList",function(c,b,d){var a=M.Event;function e(f){this.trigger=null;this.container=null;this.itemSelector="._j_listitem";this.itemHoverClass="on";this.firstItemHover=false;$.extend(this,f);this.trigger=$(this.trigger);this.container=$(this.container);this.mouseon=false;this.visible=false;this.init()}M.mix(e.prototype,{createContainer:$.noop,updateList:$.noop,init:function(){if(!this.trigger.length){M.error("no trigger for drop list")}if(!this.container.length){this.container=this.createContainer()}if(!this.container.length){M.error("no container for drop list")}this.bindEvents()},bindEvents:function(){this.trigger.on("keydown",$.proxy(function(g){var h=g.keyCode;if(this.visible&&h==13){var f=this.getFocusItem();if(f.length){this.selectItem(f);g.preventDefault()}}else{if(this.visible&&h==38){this.moveFocus(-1)}else{if(this.visible&&h==40){this.moveFocus(1)}}}},this));this.container.on("mouseenter",this.itemSelector,$.proxy(this.moveFocus,this)).on("click",this.itemSelector,$.proxy(this.clickItem,this)).on("mouseenter",$.proxy(this.mouseOverCnt,this)).on("mouseleave",$.proxy(this.mouseOutCnt,this))},show:function(g){this.updateList(g);this.container.show();if(this.firstItemHover){var f=this.container.find(this.itemSelector);if(f.length){this.moveFocus(1)}}this.visible=true},hide:function(){this.container.hide();this.visible=false},clickItem:function(g){var f=this.getFocusItem();this.selectItem(f);g.preventDefault()},selectItem:function(f){a(this).fire("itemselected",{item:f})},moveFocus:function(i){var h=this.container.find(this.itemSelector),j=this.getFocusItem(),g=j,f;if(i===-1){if(j.length){f=h.index(j)-1}if(!j.length||f==-1){g=h.last()}else{g=h.eq(f)}}else{if(i===1){if(j.length){f=h.index(j)+1}if(!j.length||f==h.length){g=h.first()}else{g=h.eq(f)}}else{if(i.currentTarget){g=$(i.currentTarget)}}}j.removeClass(this.itemHoverClass);g.addClass(this.itemHoverClass);a(this).fire("itemfocused",{prevItem:j,focusItem:g})},getFocusItem:function(){var f=this.container.find(this.itemSelector);return f.filter("."+this.itemHoverClass)},mouseOverCnt:function(){this.mouseon=true},mouseOutCnt:function(){this.mouseon=false}});return e});M.define("Suggestion",function(c){c("jq-tmpl");var a=c("InputListener");var b='{{each(i, item) list}}<li class="${listItemClass}" data-value="${item.value}">${item.text}</li>{{/each}}';function d(e){e.suggestionURL=e.url||$(e.input).data("suggestionurl");this.dropListClass="droplist";this.listItemSelector="._j_listitem";this.listItemHoverClass="on";this.listFirstItemHover=false;this.keyParamName="key";this.dataType="json";this.suggestionParams={};this.listContainer=null;M.mix(this,e);this.input=$(this.input);this.listTmpl=this.listTmpl||b;this.actOnList=false;this.init()}M.mix(d.prototype,{init:function(){a.listen(this.input,$.proxy(this.inputChange,this));this.input.blur($.proxy(function(f){var e=$(f.currentTarget);if(e.data("droplist")){setTimeout($.proxy(function(){if(!this.actOnList&&e.data("droplist")){e.data("droplist").hide()}this.actOnList=false},this),200)}},this));this.input.keyup($.proxy(function(f){var e=$(f.currentTarget);if(f.keyCode==40&&(!e.data("droplist")||!e.data("droplist").visible)){this.inputChange(f)}},this))},inputChange:function(i){var f=$(i.target),k=$.trim(f.val()),j=c("SuggestionXHR"),h=c("DropList");var g=f.data("droplist");if(!g){f.data("droplist",g=new h({trigger:f,itemSelector:this.listItemSelector,itemHoverClass:this.listItemHoverClass,firstItemHover:this.listFirstItemHover,container:this.listContainer,createContainer:$.proxy(function(){var l=this.createListContainer(f);this.listContainer=l;return l},this),updateList:$.proxy(this.updateList,this)}));M.Event(g).on("itemselected",$.proxy(function(l){this.dropItemSelected(f,l.item)},this));M.Event(g).on("itemfocused",$.proxy(function(l){M.Event(this).fire("itemfocused",l)},this))}g.hide=function(){setTimeout($.proxy(function(){if(M.windowFocused){this.container.hide();this.visible=false}},this),1)};var e=f.data("suggestion");if(!e){f.data("suggestion",e=new j({URL:this.suggestionURL,dataType:this.dataType}))}if(!k.length){e.stop();g.hide();M.Event(this).fire("after hide list")}else{this.suggestionParams[this.keyParamName]=k;M.Event(this).fire("before suggestion xhr");e.getSuggestion(this.suggestionParams,$.proxy(function(m){M.Event(this).fire("before show list");var l=this.handleSuggest(m);if(l){f.data("droplist").show(l)}},this))}},handleSuggest:function(f){var e="";if(this.dataType=="json"){e=$.tmpl(this.listTmpl,f)}return e},createListContainer:function(f){var g=$("<ul />"),e=f.position();g.css({display:"none",position:"absolute",left:e.left,top:e.top+f.outerHeight()}).addClass(this.dropListClass);g.insertAfter(f);return g},updateList:function(e){this.listContainer.html(e)},hideDropList:function(){this.input.data("droplist")&&this.input.data("droplist").hide()},dropItemSelected:function(e,f){a.unlisten(e);M.Event(this).fire("itemselected",{item:f,input:e});a.listen(e,$.proxy(this.inputChange,this))}});return d});M.define("MesSearchEvent",function(b,a,c){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(f,j){var l=e,h=[],g;j=j||l.length;if(f){for(g=0;g<f;g++){h[g]=l[0|Math.random()*j]}}else{var k;h[8]=h[13]=h[18]=h[23]="-";h[14]="4";for(g=0;g<36;g++){if(!h[g]){k=0|Math.random()*16;h[g]=l[(g==19)?(k&3)|8:k]}}}return h.join("")};Math.uuidFast=function(){var k=e,h=new Array(36),g=0,j;for(var f=0;f<36;f++){if(f==8||f==13||f==18||f==23){h[f]="-"}else{if(f==14){h[f]="4"}else{if(g<=2){g=33554432+(Math.random()*16777216)|0}j=g&15;g=g>>4;h[f]=k[(f==19)?(j&3)|8:j]}}}return h.join("")};Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(h){var g=Math.random()*16|0,f=h=="x"?g:(g&3|8);return f.toString(16)})};var d={uuid:function(){return Math.uuid()},search:function(f){var g=Math.uuid();f.id=g;!!mfwPageEvent&&mfwPageEvent("se","v2_search",f);return g},searchCache:function(f){var g=Math.uuid();f.id=g;!!mfwPageEvent&&mfwPageEvent("se","v2_search_cache",f);return g},resultClick:function(f){!!mfwPageEvent&&mfwPageEvent("se","v2_result_click",f);return f.id}};c.exports=d});M.define("/js/SiteSearch",function(e){var d="1.0.0",h=e("Suggestion"),f=e("MesSearchEvent"),g=M.cssSupport("transition"),b=M.cssSupport("transform"),c=window.Env||{};var a=function(C){var E=$("#"+C.input+""),T=!!C.submit?$("#"+C.submit+""):null,t=C.additionalClass?C.additionalClass:"",K=!!C.isRelevant,s=C.maxCount||0,z=C.hideOnScroll||false,n=false,J=false,i="",y="",l="",p="";if(C.input==="_j_index_search_input_all"){var H=[];if(E.val()===""&&H&&H.length){var S=Math.floor(Math.random()*H.length),I=H[S];E.val(I.name).data("url",I.url)}E.on("focus",function(V){if(E.data("url")){E.val("").data("url","")}})}if(c.is_async_site_search){n=true}var P=new h({url:(c.WWW_HOST?"http://"+c.WWW_HOST:"")+"/search/ss.php",suggestionParams:{isHeader:Number(K)},input:E,listItemHoverClass:"active",listFirstItemHover:false,dataType:"jsonp",createListContainer:function(){var V=$('<div class="m-search-suggest '+t+' hide"><ul class="mss-list"></ul></div>').appendTo("body");V.on("mouseenter",".mss-place .mss-title, .mss-place .mss-nav a",function(X){var W=$(X.currentTarget),Y=W.closest(".mss-place");Y.find(".mss-title").removeClass("active").removeClass("frozen").end().find(".mss-nav a").removeClass("active").end();W.addClass("active")}).on("mouseleave",".mss-place .mss-title, .mss-place .mss-nav a",function(X){var W=$(X.currentTarget);W.removeClass("active")});return V},handleSuggest:function(aB){i=aB.keyword;J=!!aB.is_hit;l="http://"+aB.www_host;var aw=aB.keyword_cut,ay=aB.show_types,W=aB.hide_types;var aq=$("<ul>");var aa=aB.first_poi;if(!!aa){var al=aa,aj=$('<li class="mss-item _j_listitem" data-type="poi">').appendTo(aq),ao=$('<div class="mss-title">').appendTo(aj);aj.attr("data-url",al.url);ao.append('<span class="mss-fr">'+(!!al.mddname?al.mddname:"")+al.typename+"</span>");ao.append('<span class="mss-cn">'+al.dis_name+"</span>")}var ag=aB.article_info;if(ag&&ag.result){for(var ar=0;ar<ag.result.length;ar++){var af=ag.result[ar],aj=$('<li class="mss-item _j_listitem" data-type="article_promoted">').appendTo(aq),ao=$('<div class="mss-title">').appendTo(aj);aj.attr("data-url",af.link);ao.html(af.name_display)}}var ak=aB.mdd_info;if(ak&&ak.result){for(var ar=0;ar<ak.result.length;ar++){var Z=ak.result[ar],aj=$('<li class="mss-item _j_listitem" data-type="mdd">').appendTo(aq),ao=$('<div class="mss-title">').appendTo(aj);aj.attr("data-url",Z.url);if(!!Z.parent){ao.append('<span class="mss-fr">'+Z.parent+"</span>")}ao.append('<span class="mss-cn">'+Z.dis_name+"</span>");ao.append('<span class="mss-gl"> '+Z.infoname+"</span>")}}var an=aB.hotel_info;if(an&&an.result&&!K){for(var ar=0;ar<an.result.length;ar++){var az=an.result[ar],aj=$('<li class="mss-item _j_listitem" data-type="hotel_promoted">').appendTo(aq),ao=$('<div class="mss-title">').appendTo(aj);aj.attr("data-url",az.url);ao.append('<span class="mss-fr">'+az.typename+"</span>");ao.append('<span class="mss-cn">'+az.title+"</span>");ao.append('<span class="mss-gl"> '+az.infoname+"</span>")}}var ad=aB.gl_info;if(ad&&ad.result){for(var ar=0;ar<ad.result.length;ar++){var ap=ad.result[ar],aj=$('<li class="mss-item _j_listitem" data-type="sales_gonglve">').appendTo(aq),ao=$('<div class="mss-title">').appendTo(aj);aj.attr("data-url",ap.url);ao.append('<span class="mss-fr">'+ap.typename+"</span>");ao.append('<span class="mss-cn">'+ap.title+"</span>")}}var Y=aB.sales_info;if(Y&&Y.result&&!K){for(var ar=0;ar<Y.result.length;ar++){var V=Y.result[ar],aj=$('<li class="mss-item _j_listitem" data-type="sales_promoted">').appendTo(aq),ao=$('<div class="mss-title">').appendTo(aj);aj.attr("data-url",V.url);ao.append('<span class="mss-fr">'+V.typename+"</span>");ao.append('<span class="mss-cn">'+V.title+"</span>");ao.append('<span class="mss-gl"> '+V.infoname+"</span>")}}var ae=aB.route_info;if(ae&&ae.result&&!K){for(var ar=0;ar<ae.result.length;ar++){var ax=ae.result[ar],aj=$('<li class="mss-item _j_listitem" data-type="route_promoted">').appendTo(aq),ao=$('<div class="mss-title">').appendTo(aj);aj.attr("data-url",ax.url);ao.append('<span class="mss-fr">'+ax.typename+"</span>");ao.append('<span class="mss-cn">'+ax.title+"</span>");ao.append('<span class="mss-gl"> '+ax.infoname+"</span>")}}var at=aB.qa_info;if(at&&at.result){for(var ar=0;ar<at.result.length;ar++){var ah=at.result[ar],aj=$('<li class="mss-item _j_listitem" data-type="wenda">').appendTo(aq),ao=$('<div class="mss-title">').appendTo(aj);aj.attr("data-url",ah.url);ao.append('<span class="mss-fr">'+ah.typename+"</span>");ao.append('<span class="mss-cn">'+ah.title+"</span>")}}var ac=aB.poi_info,av=!K;if(M.isArray(ay)&&M.indexOf(ay,"poi")!==-1){av=true}if(ac&&ac.result&&av){for(var ar=0;ar<ac.result.length;ar++){var al=ac.result[ar],X="hotel"===al.stype?"hotel":"poi",aj=$('<li class="mss-item _j_listitem" data-type="'+X+'">').appendTo(aq),ao=$('<div class="mss-title">').appendTo(aj);aj.attr("data-url",al.url);ao.append('<span class="mss-fr">'+(!!al.mddname?al.mddname:"")+al.typename+"</span>");ao.append('<span class="mss-cn" style="color:#999;">'+al.dis_name+"</span>")}}var ai=aB.sekey_info,au=K;if(M.isArray(W)&&M.indexOf(W,"sekey")!==-1){au=false}if(ai&&ai.result&&au){for(var ar=0;ar<ai.result.length;ar++){if(ar>4){break}var aA=ai.result[ar],aj=$('<li class="mss-item _j_listitem" data-type="sekey">').appendTo(aq);aj.attr("data-url",aA.url);aj.append('<div class="mss-title">'+aA.name+"</div>")}}var ab=aB.ginfo_num;if(!!ab){var aj=$('<li class="mss-item _j_listitem" data-type="info">').appendTo(aq);aj.append('<div class="mss-title">æœâ€œ<span class="mss-key">'+aw+'</span>â€ç›¸å…³æ¸¸è®°<span class="mss-num">'+ab+"ç¯‡</span></div>")}var am=aB.user_num;if(!!ab){var aj=$('<li class="mss-item _j_listitem" data-type="user">').appendTo(aq);aj.append('<div class="mss-title">æœâ€œ<span class="mss-key">'+aw+"</span>â€ç›¸å…³ç”¨æˆ·</div>")}if(s>0){aq.find("._j_listitem").each(function(aC,aD){if(aC>s){$(aD).remove()}})}return aq.html()},updateList:function(V){this.listContainer.find(".mss-list").html(V);if(K){this.listContainer.find(".mss-list").addClass("shrink-list")}if(J){P.input.data("droplist").moveFocus(1)}}});if(n){var A=e("InputListener"),w=e("SuggestionXHR"),D=new w({URL:(c.WWW_HOST?"http://"+c.WWW_HOST:"")+"/search/s.php",dataType:"json"}),v=$("#_j_mfw_search_main"),U=E.closest(".search-wrapper"),L=$('<div class="search-keyword-tip"></div>').appendTo(U),B=C.input==="_j_index_search_input_all",G=false,u,q,N,k,r;A.listen(E,function(W){var V=$(W.target),X=$.trim(V.val());if(!G&&X){G=true}L.hide()});M.Event(P).on("before suggestion xhr",function(){var V=P.suggestionParams[P.keyParamName];if(V&&V!==y){D.getSuggestion({q:V,gall:1},$.proxy(function(X){var ab=$.trim(E.val());if(!ab){return false}if(!X||!X.keyword||(!X.result&&!X.unmatch)){return false}if(X.unmatch===1){L.hide()}else{y=V;if(U[0]){var Y=X.keyword.length,W=X.keyword.replace(/[A-Za-z0-9\s]/g,"").length,aa=Y-W;setTimeout(function(){L.html(X.keyword).css("left",32+W*14+aa*7).show()},1)}v.html($(X.result).css("minHeight",0).html());if(g&&b){v.find("> .wid").addClass("anim-climb");setTimeout(function(){v.find("> .wid").removeClass("anim-climb")},1)}var Z=c.search_type||"all";c.search_seid=Q(V,Z);c.search_keyword=V;c.is_search_cache=true;c.is_search_updated=true}},P))}})}M.Event(P).on("before suggestion xhr",function(){R(E,P.listContainer)});M.Event(P).on("before show list",function(){P.listContainer.find(".mss-list").show()});M.Event(P).on("itemfocused",function(W){var V=W.prevItem,X=W.focusItem,Y=P.listContainer;if(1<Y.find(".mss-place").length){if(X.hasClass("mss-place")){Y.find(".mss-place").removeClass("frozen")}if(!X.hasClass("mss-place")&&!!V&&V.hasClass("mss-place")){Y.find(".mss-place").removeClass("frozen");V.addClass("frozen")}}if(X.hasClass("mss-place")){X.find(".mss-title").addClass("frozen")}});M.Event(P).on("itemselected",function(X){var Z=X.item;if(Z.length){var Y=Z.data("type"),W=Z.data("url"),ab=E.attr("id")==="_j_head_search_input"?"header":"default";if(Y==="flight_hotel"||Y==="flight"||Y==="local"){Y="sales"}p=m(i,"all",ab,"suggest");if("info"===Y||"user"===Y){var aa=m(i,Y,ab,"suggest");location.href=l+"/search/s.php?q="+encodeURIComponent(i)+"&t="+Y+"&seid="+aa}else{var W=Z.data("url"),V=P.listContainer.find(".mss-item").index(Z.closest(".mss-item"))+1;O(W,V,Y);location.href=Z.data("url")}}else{if(i!==""){location.href=l+"/search/s.php?q="+encodeURIComponent(i)}}});var x=E.closest(".head-search-wrapper");if(x[0]){E.on("focus",function(V){setTimeout(function(){x.addClass("head-search-focus")},1)}).on("blur",function(V){setTimeout(function(){if(M.windowFocused){x.removeClass("head-search-focus")}},1)})}if(T&&T[0]){T.on("click",function(X){var W=$.trim(E.val());if(E.data("url")){if(E.data("url").indexOf("http")!==-1){location.href=E.data("url")}else{location.href=(c.WWW_HOST?"http://"+c.WWW_HOST:"")+E.data("url")}return true}if(W!==""){if(P.listContainer){P.listContainer.hide()}var Z=E.attr("id")==="_j_head_search_input"?"header":"default",aa=c.search_type||"all",Y=m(W,aa,Z,"form"),V=l+"/search/s.php?q="+encodeURIComponent(W);if(c.search_type&&location.pathname==="/search/s.php"){V+="&t="+c.search_type}V+="&seid="+Y;location.href=V}})}if(E&&E[0]){E.on("keydown",function(X){if(X.keyCode==13){var aa=P.input.data("droplist");if(aa&&aa.getFocusItem().length){return true}var W=$.trim(E.val());if(W!==""){if(P.listContainer){P.listContainer.hide()}var Z=E.attr("id")==="_j_head_search_input"?"header":"default",ab=c.search_type||"all",Y=m(W,ab,Z,"form"),V=l+"/search/s.php?q="+encodeURIComponent(W);if(c.search_type&&location.pathname==="/search/s.php"){V+="&t="+c.search_type}V+="&seid="+Y;location.href=V}}})}$(window).resize(function(){if(P.listContainer&&P.listContainer.length&&P.listContainer.is(":visible")){R(E,P.listContainer)}});$(window).on("scroll",function(V){if(z){P.hideDropList()}});function R(V,X){var W=V.offset();X.css({left:W.left+(C.input==="_j_index_search_input_all"?0:1),top:W.top+E.outerHeight()-2})}function m(V,Z,Y,X){var W={keyword:V,content_category:Z,searchbox_category:"main_search",searchbox_position:Y,search_type:X,version:d};return f.search(W)}function Q(V,X){var W={keyword:V,content_category:X,version:d};return f.searchCache(W)}function O(Y,W,X){var V={id:p,keyword:i,click_url:Y,index:W,content_category:X,search_type:"suggest",version:d};return f.resultClick(V)}function F(W,aa){var X=[],ac=W.split("|");aa=j(aa);for(var Z=0;Z<ac.length;Z++){var Y=$.trim(ac[Z]);if(Y=="search://"){var V=X.length;X[V]=ac[Z++];X[V+1]=ac[Z++];X[V+2]=ac[Z++];X[V+3]=ac[Z++];X[V+4]=ac[Z++];X[V+5]=ac[Z];continue}if(Y){try{Y=Y.replace(new RegExp(aa,"ig"),function(ad){return'<span class="highlight">'+ad+"</span>"})}catch(ab){Y=Y.replace(aa,function(ad){return'<span class="highlight">'+ad+"</span>"})}X[X.length]=Y}}return X}var o=$("<div/>");function j(V){return o.text(V).html()}};return a});M.closure(function(c){var r=$("#header");if(!r.length){return false}var o=c("/js/Dropdown");var n=c("/js/SiteSearch");new n({input:"_j_head_search_input",submit:"_j_head_search_link",isRelevant:true});$("#_j_nav_sales").find("[data-sales-nav]").on("click",function(){var t=$(this).data("salesNav");mfwPageEvent("sales","index_sales_nav",{name:t})});if(!window.showBarFlag){$("._j_sales_nav_show").off("hover")}else{var b=0,p=0;$("._j_sales_nav_show").hover(function(){clearTimeout(b);p=setTimeout(function(){$("._j_sales_nav_show").addClass("head-nav-hover");$("._j_sales_top").fadeIn(300)},200)},function(){clearTimeout(p);b=setTimeout(function(){$("._j_sales_nav_show").removeClass("head-nav-hover");$("._j_sales_top").fadeOut(300)},200)})}var m=0,f=0;$("._j_shequ_nav_show").hover(function(){clearTimeout(m);f=setTimeout(function(){$("._j_shequ_nav_show").addClass("head-nav-hover");$("._j_shequ_top").fadeIn(300)},200)},function(){clearTimeout(f);m=setTimeout(function(){$("._j_shequ_nav_show").removeClass("head-nav-hover");$("._j_shequ_top").fadeOut(300)},200)});var q=$("#_j_community_panel"),i=q.find(".panel-image").length,j=Math.floor(Math.random()*i);if(j===i){j--}q.find(".panel-image").eq(j).show();$("#_j_showlogin").click(function(t){if(window.location.host===Env.WWW_HOST){t.preventDefault()}M.Event.fire("login:required")});var g=window.location.hostname,k=window.location.pathname+window.location.search,a=$("#_j_head_nav");if(g.indexOf("www")===0){if(k===""||k==="/"){a.children("li:eq(0)").addClass("head-nav-active")}var h=new RegExp("^/(mdd|photo/mdd|poi|photo/poi|travel-scenic-spot|jd|cy|gw|yl|yj|xc|baike)/|sFrom=mdd.*|sFrom=smdd.*","i");if(h.test(k)){a.children("li:eq(1)").addClass("head-nav-active")}var e=new RegExp("^/gonglve/.*","i");if(e.test(k)){a.children("li:eq(2)").addClass("head-nav-active")}var d=window.Env&&window.Env.sales_title_tag;if(d){if(d==="flight_hotel"){a.children("li:eq(3)").find("ul>li:eq(0)>a").addClass("on")}else{if(d==="visa"){a.children("li:eq(3)").find("ul>li:eq(2)>a").addClass("on")}else{if(d==="localdeals"){a.children("li:eq(3)").find("ul>li:eq(1)>a").addClass("on")}else{if(d==="insurance"){a.children("li:eq(3)").find("ul>li:eq(4)>a").addClass("on")}}}}a.find("li:eq(3)").addClass("head-nav-active")}if(/^\/insurance\//i.test(k)){a.find("li:eq(3)").addClass("head-nav-active")}var s=new RegExp("^/hotel/(?!.*sFrom=mdd).*","ig");if(s.test(k)){a.children("li:eq(4)").addClass("head-nav-active");a.children("li:eq(4)").find(".head-act616").remove()}var l=new RegExp("^/(wenda|qa|mall|together|group|i|traveller|rudder|paimai|club|postal|school|photo_pk|focus)/(?!.*sFrom=mdd|s.php*).*","i");if(l.test(k)){a.children("li:eq(5)").addClass("head-nav-active")}}});M.define("/js/sales/navbar",function(b,a,c){var d=function(e){this.config=$.extend(true,{},this.config,e)};d.prototype={$navbar:null,$anchors:null,config:{offsetTop:0,navbar:".sales-nav",wrapper:".sales-nav-wrap",anchors:"",resizeEvents:[]},anchorsTop:[],init:function(){var e=this;this.$navbar=$(this.config.navbar);if(this.config.anchors){this.$anchors=$(this.config.anchors)}$(window).on("scroll",function(){e.onScroll()});$(document).on(this.config.resizeEvents.join(" "),function(){e.reset()});if(this.config.anchors){var f="body";if(!("navigator" in window)||!("userAgent" in window.navigator)||window.navigator.userAgent.toLocaleLowerCase().indexOf("firefox")>=0||window.navigator.userAgent.toLocaleLowerCase().indexOf("trident")>=0){f="html"}this.$navbar.find("a[href^=#]").click(function(k){var l=$(this).attr("href");var h=$(l);if(h.length){var g=h.offset().top;var j=Math.abs($(window).scrollTop()-g);var i=Math.min(500,j/2);$(f).stop().animate({scrollTop:h.offset().top},i);k.preventDefault()}})}e.reset()},reset:function(){var e=this;this.navTop=parseInt($(this.config.wrapper).offset().top)-this.config.offsetTop;if(this.config.anchors){this.$anchors.each(function(f){e.anchorsTop[f]=$(this).offset().top})}this.onScroll()},onScroll:function(){var e=this;var f=$(window).scrollTop();if(f>this.navTop){this.$navbar.addClass("fixed")}else{this.$navbar.removeClass("fixed")}if(this.config.anchors){$.each(this.anchorsTop,function(g,j){if(j-80-e.config.offsetTop<f){var h=e.$navbar.find('a[href="#'+e.$anchors.eq(g).attr("id")+'"]');h.closest("li").addClass("on").siblings().removeClass("on")}})}}};c.exports=d});(function(){var b=function(){};b.prototype={getPath:function(c){if(c[0]!="/"){c="/"+c}if(c[c.length-1]!="/"){c+="/"}if(c.indexOf("/rest/")!==0){c="/rest"+c}return c},get:function(g,c,h,d,f){var e={};if(d){e.data_style=d}if(f){e.data_decorate=f}return $.get(this.getPath(g)+c,e,h,"json")},getMulti:function(j,e,g,i,k,h,d,c){var f={};if(e){f.filter=e}if(g){f.page=g}if(k){f.data_style=k}if(h){f.data_decorate=h}if(d){f.ex_style=d}if(c){f.ex_decorate=c}return $.get(this.getPath(j),f,i,"json")},post:function(g,i,h,c,e,d){var f={update:i};if(c){f.post_style=c}if(e){f.after_style=e}if(d){f.after_decorate=d}return $.post(this.getPath(g),f,h,"json")},put:function(l,i,d,k,g,h,f,j,c){var e={method:"PUT",update:d};if(g){e.put_style=g}if(h){e.after_style=h}if(f){e.after_decorate=f}if(j){e.before_style=j}if(c){e.before_decorate=c}return $.post(this.getPath(l)+i,e,k,"json")},"delete":function(g,e,h,c,d){var f={method:"DELETE"};if(c){f.before_style=c}if(d){f.before_decorate=d}return $.post(this.getPath(g)+e,f,h,"json")}};b.prototype.constructor=b;var a=new b();window.mfwRest=a;if(window.M&&M.define){M.define("/js/localdeals/rest",function(){return a})}})();M.define("/js/sales/stock",function(c,b,d){var a=c("/js/localdeals/rest");var e=0;var g=2;var f=function(h){this.config=$.extend(true,{},this.config,h)};f.EVENT_CHANGE_NUMS="stock_change_nums";f.EVENT_SELECT_LEAF="stock_select_leaf";f.EVENT_CHANGE_CALENDAR="stock_change_calendar";f.EVENT_SELECT_NODE="stock_select_node";f.EVENT_SELECT_DATE="stock_select_date";f.EVENT_CHANGE_MONTH="stock_select_month";f.EVENT_SOLD_OUT="stock_sold_out";f.MODE_FENGQIANG=1;f.MODE_GET_N_OFF_M=2;f.MODE_GET_N_OFF_M_KEY_PERCENT=0;f.MODE_GET_N_OFF_M_KEY_PRICE=1;f.prototype={config:{clickEvent:"click",hideCartBlock:".intro-r",salesId:0,scope:"sales",giftCode:null,structureOnCss:"on",structureDisabledCss:"disabled",calendarOnCss:"on",calendarDisabledCss:"disabled",selectFirstStock:true,calendarScrollLeft:"",calendarScrollRight:"",calendarPrev:"",calendarNext:"",numButton:"[data-action=plus],[data-action=minus]",structureWrapper:"",remainSpan:"",calendarWrapper:"",calendarBlock:"",sidebarCalendarWrapper:"",totalPriceSelector:"",totalPriceExtStrSelector:".total-price-ext",adultNumSpan:"",adultText:"",adultChangeText:"æ•°é‡",adultPriceSpan:"",kidAmountBlock:"",kidBlock:"",kidNumSpan:"",kidPriceSpan:"",infantAmountBlock:"",infantBlock:"",infantNumSpan:"",roomAmountBlock:"",roomBlock:"",roomNumSpan:"",singleRoomBlock:"",singleRoomTotalPriceSpan:"",singleRoomPriceSpan:"",buyButton:"",bargainButton:"",noStockMsg:"è¯·é€‰æ‹©æ—¥æœŸ",selectD:false},calendarCache:{},sidebarCalendarCache:{},selectedStock:{},rememberNums:{adult:0,kid:0,infant:0,room:0},nums:{adult:0,kid:0,infant:0,room:0,singleRoom:0},price:{total:0,singleRoom:0},mode:{type:0},currentMonth:"",rememberDate:"",isSoldOut:false,trigger:function(h,i){if(i){$(document).trigger(h,i)}else{$(document).trigger(h)}},on:function(h,i){$(document).on(h,function(k,j){i(j)})},init:function(){this.initEventHandler();this.config.adultText=$("[data-adult]").eq(0).text();if(this.config.selectFirstStock){var h=this.getFirstEnableId(0);if(h){this.selectNode(h)}else{this.trigger(f.EVENT_SOLD_OUT);this.isSoldOut=true}}},initEventHandler:function(){var h=this;this.on(f.EVENT_SELECT_LEAF,function(j){h.selectedStock=j||{};if(j){if(!("kidPrice" in j)){j.kidPrice=0}}else{}h.setNum("all",0,false);if(h.selectedStock){if(h.config.remainSpan){$(".stock-remain").show();$(h.config.remainSpan).html(h.selectedStock.remain|0)}}else{$(".stock-remain").hide()}$(h.config.adultPriceSpan).html(h.selectedStock.price);$(h.config.kidPriceSpan).html(h.selectedStock.kidPrice);$(h.config.singleRoomPriceSpan).html(h.selectedStock.singleRoomPrice);if(h.selectedStock.kidPrice){$(h.config.kidAmountBlock).show();h.kidFlag=false}else{$(h.config.kidAmountBlock).hide();h.kidFlag=true}if(h.selectedStock.infant){$(h.config.infantAmountBlock).show();h.infantFlag=false}else{$(h.config.infantAmountBlock).hide();h.infantFlag=true}if(h.selectedStock.singleRoomPrice){$(h.config.roomAmountBlock).show();h.roomFlag=false}else{$(h.config.roomAmountBlock).hide();h.roomFlag=true}var i=$("[data-adult]");if(h.kidFlag&&h.infantFlag&&h.roomFlag){i.text(h.config.adultChangeText)}else{i.text(h.config.adultText)}h.changePrice()});this.on(f.EVENT_CHANGE_NUMS,function(){if(h.config.kidBlock){if(h.nums.kid){$(h.config.kidNumSpan).html(h.nums.kid);$(h.config.kidBlock).show()}else{$(h.config.kidBlock).hide()}}if(h.config.infantBlock){if(h.nums.infant){$(h.config.infantNumSpan).html(h.nums.infant);$(h.config.infantBlock).show()}else{$(h.config.infantBlock).hide()}}if(h.config.singleRoomBlock){if(h.nums.singleRoom){$(h.config.singleRoomBlock).show()}else{$(h.config.singleRoomBlock).hide()}}if(h.config.roomBlock){if(h.nums.room){$(h.config.roomBlock).show()}else{$(h.config.roomBlock).hide()}}$(h.config.adultNumSpan).html(h.nums.adult);$(h.config.kidNumSpan).html(h.nums.kid);$(h.config.infantNumSpan).html(h.nums.infant);$(h.config.roomNumSpan).html(h.nums.room);h.changePrice()});if(h.config.calendarScrollLeft){this.on(f.EVENT_CHANGE_CALENDAR,function(){var k=$(h.config.calendarScrollLeft);var l=$(h.config.calendarScrollRight);k.addClass("tab-arrDisabled");var i=$(".tab-box li:last");var j=i.position().left+i.outerWidth();if(j>$(".cal-tab").width()){l.removeClass("tab-arrDisabled")}else{l.addClass("tab-arrDisabled")}})}this.on(f.EVENT_CHANGE_CALENDAR,function(){var i=$(h.config.calendarWrapper).find("[data-calendar]").attr("data-calendar");if(h.rememberDate&&h.rememberDate.substr(0,7)!=i){i=h.rememberDate.substr(0,7)}h.trigger(f.EVENT_CHANGE_MONTH,i)});this.on(f.EVENT_CHANGE_MONTH,function(l){var j=$('[data-month-tab="'+l+'"]'),i=$('[data-calendar="'+l+'"]');if(!j.lenght&&!i.length){h.currentMonth=h.getFirstEnableDate().substr(0,7)}else{if(l){h.currentMonth=l;$("[data-month-tab]").parent().removeClass("on");var k=$('[data-month-tab="'+l+'"]').parent().addClass("on");$("[data-calendar]").hide().filter('[data-calendar="'+l+'"]').show();if(k.next().length){$(".cal-month .arrow-next").removeClass("disabled")}else{$(".cal-month .arrow-next").addClass("disabled")}if(k.prev().length){$(".cal-month .arrow-prev").removeClass("disabled")}else{$(".cal-month .arrow-prev").addClass("disabled")}}else{h.currentMonth=h.getFirstEnableDate().substr(0,7)}}});$(this.config.structureWrapper).on(this.config.clickEvent,"[data-stock-id]",function(){h.selectNode($(this).attr("data-stock-id"));var i=$("[data-adult]");if(h.kidFlag&&h.infantFlag&&h.roomFlag){i.text(h.config.adultChangeText)}else{i.text(h.config.adultText)}});$(this.config.calendarWrapper).on(this.config.clickEvent,"[data-stock-id]",function(){h.selectDate($(this).attr("data-name"))});if(this.config.sidebarCalendarWrapper){$(this.config.sidebarCalendarWrapper).on(this.config.clickEvent,"[data-stock-id]",function(){h.selectDate($(this).attr("data-name"))})}if(h.config.calendarScrollRight){$(document).on(h.config.clickEvent,h.config.calendarScrollRight,function(){h.monthTabRight()})}if(h.config.calendarScrollLeft){$(document).on(h.config.clickEvent,h.config.calendarScrollLeft,function(){h.monthTabLeft()})}if(h.config.calendarNext){$(document).on(h.config.clickEvent,h.config.calendarNext,function(){var j=$(this);if(!j.hasClass("disabled")){var i=$(h.config.calendarWrapper).find('[data-calendar="'+h.currentMonth+'"]').next();var k=i.attr("data-calendar");h.trigger(f.EVENT_CHANGE_MONTH,k)}})}if(h.config.calendarPrev){$(document).on(h.config.clickEvent,h.config.calendarPrev,function(){var j=$(this);if(!j.hasClass("disabled")){var i=$(h.config.calendarWrapper).find('[data-calendar="'+h.currentMonth+'"]').prev();var k=i.attr("data-calendar");h.trigger(f.EVENT_CHANGE_MONTH,k)}})}$(document).on(this.config.clickEvent,"[data-month-tab]",function(){var i=$(this).attr("data-month-tab");h.trigger(f.EVENT_CHANGE_MONTH,i)});$(this.config.numButton).on(this.config.clickEvent,function(){if(h.isSoldOut){return}if(h.config.selectD){var j=$(this).data("value");if(h.nums.hasOwnProperty(j)){var i=h.nums[j];if($(this).data("action")=="plus"){h.setNum(j,i+1,true)}else{h.setNum(j,i-1,true)}}}else{if(typeof mAlert=="function"){mAlert(h.config.noStockMsg)}else{alert(h.config.noStockMsg)}}});$(this.config.buyButton).on(this.config.clickEvent,function(i,j){if(!$(this).is(h.config.buyButton)){return}if(h.config.selectD){h.gotoBuy()}else{if(typeof mAlert=="function"){mAlert(h.config.noStockMsg)}else{alert(h.config.noStockMsg)}}});$(this.config.bargainButton).on(this.config.clickEvent,function(){if(h.config.selectD){h.gotoBargain()}else{if(typeof mAlert=="function"){mAlert(h.config.noStockMsg)}else{alert(h.config.noStockMsg)}}})},selectNode:function(h){var j=$(this.config.structureWrapper).find('[data-stock-id="'+h+'"]');var k=j.data();if(j.hasClass(this.config.structureDisabledCss)){return}if(k.childType==0){this.config.selectD=true}if(k.level==0){if(k.mode&&k.mode>0){this.mode={type:k.mode|0,saleOnBefore:k.saleOnBefore==1,saleOnAfter:k.saleOnAfter==1,sellingTime:parseFloat(k.sellingTime)||0,offlineTime:parseFloat(k.offlineTime)||0,discount:{key:k.discountKey|0,val:parseFloat(k.discountVal||0),minNum:k.discountMinNum|0}}}else{this.mode={type:0}}if(this.config.hideCartBlock){if(this.mode.type==f.MODE_GET_N_OFF_M){$(this.config.hideCartBlock).addClass("hide-cart")}else{$(this.config.hideCartBlock).removeClass("hide-cart")}}var i=$(".action-panel .bargain");if(i.length){i[k.role==1?"hide":"show"]()}}j.addClass(this.config.structureOnCss).siblings().removeClass(this.config.structureOnCss);this.trigger(f.EVENT_SELECT_NODE,k);var m=j.closest("[data-stock-level]").data("stockLevel");$('[data-stock-level="'+(m+1)+'"]').hide();var l=this.getFirstEnableId(h);$(".stock_"+h).show();if(l){this.selectNode(l)}switch(j.attr("data-child-type")|0){case g:this.showCalendar(h);break;case e:this.hideCalendar();this.trigger(f.EVENT_SELECT_LEAF,k);break}},selectDate:function(i){var h=this.getDateEl(i);if(h!=null){$(this.config.calendarWrapper).find("[data-stock-id]."+this.config.calendarOnCss).removeClass(this.config.calendarOnCss);h.addClass(this.config.calendarOnCss);$(this.config.sidebarCalendarWrapper).find("[data-stock-id]."+this.config.calendarOnCss).removeClass(this.config.calendarOnCss);$(this.config.sidebarCalendarWrapper).find('[data-name="'+i+'"]').addClass(this.config.calendarOnCss);this.rememberDate=i;this.config.selectD=true;this.trigger(f.EVENT_SELECT_DATE,i);this.trigger(f.EVENT_SELECT_LEAF,h.data())}},getDateEl:function(i){if(i){var h=$(this.config.calendarWrapper).find('[data-name="'+i+'"]');if(h.length){return h}}return null},showCalendar:function(h){var i=this;$(i.config.calendarWrapper).html("");if(i.config.sidebarCalendarWrapper){$(i.config.sidebarCalendarWrapper).html("")}$(i.config.calendarBlock).show();if(this.calendarCache[h]){$(i.config.calendarWrapper).html(i.calendarCache[h]);if(i.config.sidebarCalendarWrapper){$(i.config.sidebarCalendarWrapper).html(i.sidebarCalendarCache[h])}if(i.rememberDate){if(this.getDateEl(i.rememberDate)){i.config.selectD=true;i.selectDate(i.rememberDate)}else{i.config.selectD=false;i.trigger(f.EVENT_SELECT_LEAF,"");$("[data-date]").text("è¯·é€‰æ‹©æ—¥æœŸ");$(".stock-remain").hide()}}else{i.config.selectD=false;$("[data-date]").text("è¯·é€‰æ‹©æ—¥æœŸ");i.trigger(f.EVENT_SELECT_LEAF,"");$(".stock-remain").hide()}i.trigger(f.EVENT_CHANGE_CALENDAR,h)}else{a.getMulti("/sales/stock",{type:"calendar",parent_id:h,sales_id:i.config.salesId},{},function(k){if(k.errno){}else{var j=k.data.list;i.calendarCache[h]=j[0];$(i.config.calendarWrapper).html(j[0]);if(i.config.sidebarCalendarWrapper){i.sidebarCalendarCache[h]=j[1];$(i.config.sidebarCalendarWrapper).html(j[1])}if(i.rememberDate){if(i.getDateEl(i.rememberDate)){i.config.selectD=true;i.selectDate(i.rememberDate)}else{i.config.selectD=false;i.trigger(f.EVENT_SELECT_LEAF,"");$("[data-date]").text("è¯·é€‰æ‹©æ—¥æœŸ");$(".stock-remain").hide()}}else{i.config.selectD=false;i.trigger(f.EVENT_SELECT_LEAF,"");$("[data-date]").text("è¯·é€‰æ‹©æ—¥æœŸ");$(".stock-remain").hide()}i.trigger(f.EVENT_CHANGE_CALENDAR,h)}},"html")}},hideCalendar:function(){$(this.config.calendarBlock).hide()},getFirstEnableId:function(i){var h=$(".stock_"+i).find("[data-stock-id]:not(."+this.config.structureDisabledCss+")").eq(0);if(h.length){return h.attr("data-stock-id")|0}else{return 0}},getFirstEnableDate:function(){var h=this.getFirstDateNode();return h.attr("data-name")},getFirstDateNode:function(){return $(this.config.calendarWrapper).find("[data-stock-id]:not(."+this.config.calendarDisabledCss+")").eq(0)},monthTabLeft:function(){var h=$(".cal-month>.tab-arrLeft");if(!h.hasClass("tab-arrDisabled")){var i=$(".tab-box");var j=parseInt(i.css("margin-left"));$(".tab-box li").each(function(){var l=$(this).prev();var k=Math.ceil($(this).position().left);if(k+1>=-j){var m=k-l.outerWidth(true);if(m<=0){m=0;h.addClass("tab-arrDisabled")}i.animate({"margin-left":-m},200);$(".cal-month>.tab-arrRight").removeClass("tab-arrDisabled");return false}})}},monthTabRight:function(){var j=$(".cal-month>.tab-arrRight");if(!j.hasClass("tab-arrDisabled")){var h=$(".tab-box");var i=parseInt(h.css("margin-left"));$(".tab-box li").each(function(){var k=Math.ceil($(this).position().left);if(k>=-i){var n=k+$(this).outerWidth(true);var l=$(".tab-box li:last");var m=l.position().left+l.outerWidth()-$(".cal-tab").width();if(n>=m){j.addClass("tab-arrDisabled");n=m}h.animate({"margin-left":-n},200);$(".cal-month>.tab-arrLeft").removeClass("tab-arrDisabled");return false}})}},setNum:function(r,n,o){if(!this.selectedStock||!this.selectedStock.stockId){return}var i=$.extend(true,{},this.nums);if(r=="all"){this.nums.adult=this.rememberNums.adult;this.nums.kid=this.rememberNums.kid;this.nums.infant=this.rememberNums.infant;this.nums.room=this.rememberNums.room}if(r=="adult"){this.nums.adult=n}if(r=="kid"){this.nums.kid=n}if(r=="infant"){this.nums.infant=n}if(r=="room"){this.nums.room=n}if(this.nums.adult<this.selectedStock.min){this.nums.adult=this.selectedStock.min}var j=Math.min(this.selectedStock.max,this.selectedStock.remain);if(this.config.giftCode){j=1}if(this.nums.adult>j){this.nums.adult=j}var h;if(this.config.scope=="sales"){h=Math.min(this.nums.adult*2,this.selectedStock.kidRemain)}else{h=Math.min(this.selectedStock.max,this.selectedStock.remain)-this.nums.adult}if(this.selectedStock.kidPrice<=0){h=0}if(this.nums.kid>h){this.nums.kid=h}if(this.nums.kid<0){this.nums.kid=0}var q=this.nums.adult;if(this.nums.infant>q){this.nums.infant=q}if(this.nums.infant<0){this.nums.infant=0}var l=0;var m=0;if(this.selectedStock.singleRoomPrice>0){l=Math.ceil(this.nums.adult/2);m=this.nums.adult}else{m=l=0}if(this.nums.room<l){this.nums.room=l}if(this.nums.room>m){this.nums.room=m}if(r=="adult"){this.nums.room=l}if(this.selectedStock.singleRoomPrice>0){this.nums.singleRoom=this.nums.room*2-this.nums.adult}else{this.nums.singleRoom=0}var k=false;var p=this;$.each(i,function(s,t){if(t!=p.nums[s]){k=true;if(o&&r==s){p.rememberNums[s]=p.nums[s]}}});if(k){this.trigger(f.EVENT_CHANGE_NUMS,this.nums)}},changePrice:function(){this.price.singleRoom=this.round(this.selectedStock.singleRoomPrice*this.nums.singleRoom);var h=this.selectedStock.price*this.nums.adult+this.selectedStock.kidPrice*this.nums.kid+this.price.singleRoom;var j="";if(this.mode.type==f.MODE_GET_N_OFF_M){var i=new Date().getTime();if(this.mode.offlineTime>i&&(this.mode.sellingTime<i||!this.mode.saleOnBefore)){if(this.nums.adult>=this.mode.discount.minNum){var k=0;if(this.mode.discount.key==f.MODE_GET_N_OFF_M_KEY_PERCENT){k=this.round(this.mode.discount.val*this.selectedStock.price)}else{if(this.mode.discount.key==f.MODE_GET_N_OFF_M_KEY_PRICE){k=this.mode.discount.val}}h-=k;j="ï¼ˆç¬¬"+this.mode.discount.minNum+"ä»½å·²çœ"+k+"å…ƒï¼‰"}}else{}}this.price.total=this.round(h);if(this.config.giftCode){this.price.total=0}if(isNaN(this.price.total)){$(this.config.totalPriceSelector).html("--")}else{$(this.config.rmbFlag).removeClass("hide");$(this.config.totalPriceSelector).html(this.price.total)}if(this.config.totalPriceExtStrSelector){$(this.config.totalPriceExtStrSelector).html(j)[j?"show":"hide"]()}if(this.price.singleRoom){$(this.config.singleRoomTotalPriceSpan).html(this.price.singleRoom);$(this.config.singleRoomBlock).show()}else{$(this.config.singleRoomBlock).hide()}},round:function(h){return Math.round(h*100)/100},gotoBuy:function(){if(!this.selectedStock||!this.selectedStock.stockId){return}var i={};i.sales_id=this.config.salesId;i.stock_id=this.selectedStock.stockId;i.num=this.nums.adult;i.infant_num=this.nums.infant;i.kid_num=this.nums.kid;i.room_num=this.nums.room;if(this.config.giftCode&&this.config.giftCode.length){i.gift_code=this.config.giftCode}var h=$.param(i);location.href="/sales/booking.php?"+h},gotoBargain:function(){var i={bargain:1};i.sales_id=this.config.salesId;i.stock_id=this.selectedStock.stockId;i.num=this.nums.adult;i.infant_num=this.nums.infant;i.kid_num=this.nums.kid;i.room_num=this.nums.room;if(this.config.giftCode&&this.config.giftCode.length){i.gift_code=this.config.giftCode}var h=$.param(i);location.href="/sales/booking.php?"+h}};d.exports=f});M.define("/js/sales/sidebar",function(b,a,c){var e=b("/js/sales/stock");var d=function(f){this.config=$.extend(true,{},this.config,f)};d.prototype={$sidebar:null,config:{sidebar:".side-bar",wrapper:".detail-wrapper",resizeEvents:[]},sidebarTop:0,sidebarHeight:0,sidebarMaxTop:0,init:function(){this.initDropMenu();this.initOtaContact();this.initFixed();$(document).on(e.EVENT_SELECT_NODE,function(g,f){$("#sidebar_stock_wrapper").find('[data-stock-id="'+f.stockId+'"]').closest(".ui-bookDrop").find(".trigger .label").html(f.name)});$(document).on(e.EVENT_SELECT_DATE,function(g,f){$(".side-bar .bookDate-trigger .label").html(f)})},initDropMenu:function(){$(".m-book").on("click",".trigger",function(){var f=$(this);var j=f.parent();var h=$(this).nextAll(".s_popup");if(h.is(":visible")){}else{h.show();j.addClass("drop-open");var g=h.children(".drop-menu");if(g.length){g.css({"max-height":"",overflow:""});var i=$(window).height()-h.position().top-20;if(i<g.height()){g.css({"max-height":i+"px",overflow:"scroll"})}}setTimeout(function(){$(document.body).on("click",function(l){var k=$(l.target);if(!k.closest(j).length||k.closest(f).length||k.closest("[data-stock-id]").length||k.is("[data-stock-id]")||k.is(".btn")){h.hide();j.removeClass("drop-open");$(document.body).off("click",arguments.callee)}})},0)}})},initOtaContact:function(){var f=this;$(this.config.sidebar).find(".m-contact .s-more").click(function(){var g=$(this).nextAll(".contact-pop");if(g.is(":visible")){g.hide()}else{$(f.config.sidebar).find(".m-contact .contact-pop").hide();g.show()}})},initFixed:function(){var f=this;this.$sidebar=$(this.config.sidebar);$(window).on("scroll",function(){f.onScroll()});$(document).on(this.config.resizeEvents.join(" "),function(){f.reset()});f.reset()},reset:function(){var f=$(this.config.wrapper);this.sidebarTop=parseInt(f.offset().top);this.sidebarHeight=parseInt(this.$sidebar.outerHeight());this.sidebarMaxTop=this.sidebarTop+f.height()-this.sidebarHeight;this.onScroll()},onScroll:function(){var f=$(window).scrollTop();if(f>=this.sidebarTop){if(f>=this.sidebarMaxTop){this.$sidebar.addClass("absolute");this.$sidebar.addClass("fixed")}else{this.$sidebar.addClass("fixed");this.$sidebar.removeClass("absolute")}}else{this.$sidebar.removeClass("fixed")}}};c.exports=d});M.define("/js/sales/cart-v2",function(b,a,c){var f=b("/js/sales/stock");var e=function(g){this.dataList=[];this.dataMap={};this.config=$.extend(true,{},this.config,g)};e.EVENT_ADD_ITEM="cart_add_item";e.EVENT_REMOVE_ITEM="cart_remove_item";e.prototype.config={salesId:0,scope:"sales"};e.prototype.dataList=[];e.prototype.dataMap={};e.prototype.addItem=function(l,h,i,g){h|=0;i|=0;g|=0;var j=this.dataMap[l.stockId];if(!j){l.num=0;l.roomNum=0;l.kidNum=0;l.singleRoomNum=0;this.dataMap[l.stockId]=l;this.dataList.push(l);j=l}if(!h||j.remain<j.num+h||(j.max&&j.max<j.num+h)){return{error:"max",max:j.max?Math.min(j.max,j.remain):j.remain,index:d(this.dataList,j)}}if(i&&(j.kidRemain<j.kidNum+i||2*(j.num+h)<j.kidNum+i)){return{error:"max-kid",max:Math.min(2*(j.num+h),j.kidRemain),index:d(this.dataList,j)}}j.num+=h;j.kidNum+=i;if(j.singleRoomPrice){var k=Math.ceil(j.num/2);if(l==j){if(g<k||g>j.num){return{error:"roomNum"}}j.roomNum=g}else{j.roomNum=k}j.singleRoomNum=j.roomNum*2-j.num}return this.getItem(j)};e.prototype.removeItem=function(g){delete this.dataMap[this.dataList[g].stockId];this.dataList.splice(g,1);return g};e.prototype.removeItemById=function(g){var i=this.dataMap[g],h=d(this.dataList,i);delete this.dataMap[g];this.dataList.splice(h,1);return h};e.prototype.clear=function(){this.dataList=[];this.dataMap={}};e.prototype.getItem=function(g){var i=typeof g=="object"?g:this.dataMap[g],h=d(this.dataList,i),j={index:h,stockId:i.stockId,name:i.name,num:i.num,kidNum:i.kidNum,roomNum:i.roomNum,price:this.toFixed(i.price*i.num+i.kidPrice*i.kidNum),kidPrice:i.kidPrice,singleRoomPrice:this.toFixed(i.singleRoomNum*i.singleRoomPrice)};j.totalPrice=this.toFixed(j.price+j.singleRoomPrice);return j};e.prototype.getCartInfo=function(){var k=[],g=0,l=0;for(var h=0;h<this.dataList.length;h++){var j=this.getItem(this.dataList[h]);g+=j.totalPrice;l+=j.singleRoomPrice;k.push(j)}return{list:k,totalPrice:g,singleRoomPrice:l}};e.prototype.getTotalPrice=function(){var g=0;for(var h=0;h<this.dataList.length;h++){var j=this.dataList[h];g+=j.price*j.num;g+=j.kidPrice*j.kidNum;g+=j.singleRoomNum*j.singleRoomPrice}return this.toFixed(g)};e.prototype.toFixed=function(g){if(g.toFixed){return parseFloat(g.toFixed(2))}else{return parseFloat(Math.round(100*g)/100)}};e.prototype.init=function(){var l=this;var j=$(".cart-list");var g=$(".cart-action");var i=null;var k={};$(document).on(f.EVENT_CHANGE_NUMS,function(n,m){k=m});var h=[];$(document).on(f.EVENT_SELECT_NODE+" "+f.EVENT_SELECT_LEAF,function(m,n){if(n){h[n.level]=n.name;h.length=(n.level|0)+1;i=n}});$(".cart .trigger a").click(function(){if(i&&i.childType==0){var p=$.extend(true,{},i);var n=h[0];if(h.length>1){n+='<br><span class="sub">';n+=h[1];if(h.length>2){n+=" "+h[2]}n+="</span>"}p.name=n;var q=l.addItem(p,k.adult,k.kid,k.room);var m=j.find("li:not(.cart-action)").eq(q.index);if(q.error){m.removeClass("blink");setTimeout(function(){m.addClass("blink")},0)}else{j.closest(".s_popup").show();if(!m.length){var o='<li class="clearfix">    <span class="col-tit s-title"></span>    <span class="col-num s-qty"></span>    <span class="col-price s-right">        <a href="javascript:void(0)" class="btn-remove"></a>        <span>ï¿¥</span>    </span></li>';m=$(o).insertBefore(g);m.find(".btn-remove").click(function(){l.removeItem(m.index());m.remove();g.find(".total-price").html(l.getTotalPrice());if(!l.dataList.length){j.closest(".s_popup").hide()}$(document).trigger(e.EVENT_REMOVE_ITEM)});m.data("id",q.stockId)}m.find(".col-tit").html(q.name);if(q.kidNum>0){m.find(".col-num").html("æˆäººx"+q.num+"<br>å„¿ç«¥x"+q.kidNum)}else{if(q.kidPrice>0){m.find(".col-num").html("æˆäººx"+q.num)}else{m.find(".col-num").html("x"+q.num)}}m.find(".col-price span").html("ï¿¥"+q.totalPrice);g.find(".cart-total strong").html("ï¿¥"+l.getTotalPrice());$(document).trigger(e.EVENT_ADD_ITEM)}}else{if(i&&i.childType==2){if(typeof mAlert=="function"){mAlert("è¯·é€‰æ‹©æ—¥æœŸ")}else{alert("è¯·é€‰æ‹©æ—¥æœŸ")}}else{if(typeof mAlert=="function"){mAlert("è¯·é€‰æ‹©åº“å­˜")}else{alert("è¯·é€‰æ‹©åº“å­˜")}}}});$(".cart-action .btn").click(function(){var n=l.getCartInfo().list;if(n.length){var m=$('<form method="post">').hide();m.attr("action","/"+l.config.scope+"/booking.php");m.append($('<input name="sales_id]">').val(l.config.salesId));$.each(n,function(){m.append($('<input name="inventory_id[]">').val(this.stockId));m.append($('<input name="count[]">').val(this.num));m.append($('<input name="kid_num[]">').val(this.kidNum));m.append($('<input name="room_num[]">').val(this.roomNum))});m.appendTo(document.body);m.submit().remove()}})};function d(j,h){if(j.indexOf){return j.indexOf(h)}else{for(var g=0;g<j.length;g++){if(j[g]==h){return g}}return -1}}c.exports=e});(function(){})();M.define("/js/sales/countdown",function(b,a,c){var d=function(e){this.$el=$(e);this.target=0};d.prototype={zero:function(f,e){var f=parseInt(f,10);if(f>0){if(f<=9&&e!=1){f="0"+f}return String(f)}else{return e==1?"0":"00"}},caculate:function(){var e=(new Date()).valueOf();var f=Math.round((this.target-e)/100);var g={msec:"00",sec:"00",mini:"00",hour:"00",dur:f};if(f>0){g.msec=this.zero(f%10);g.sec=Math.floor(f/10)>0?this.zero(Math.floor(f/10)%60):"00";g.mini=Math.floor(f/600)>0?this.zero(Math.floor(f/600)%60):"00";g.hour=Math.floor(f/36000)>0?this.zero(Math.floor(f/36000)%24):"00";g.day=Math.floor(f/864000)>0?Math.floor(f/864000):"0"}return g},correctTime:function(){var e=this;if("serverTimeDiff" in d){e.target+=d.serverTimeDiff}else{if(!d.lock){d.lock=true;$.getJSON("/sales/ajax.php",{act:"GetTime"},function(g){d.lock=false;if(g.ret==1){var f=parseInt(g.msg);d.serverTimeDiff=((new Date()).valueOf()-f);e.target+=d.serverTimeDiff}})}}},setTargetTime:function(f){if(f){this.target=f;this.correctTime();var e=this.caculate();if(e.dur>0){this.start();return true}else{this.stop();return false}}else{this.stop();return false}},_interval:0,start:function(){if(!this._interval){var e=this;this._interval=setInterval(function(){e.interval()},100);e.interval()}},stop:function(){clearInterval(this._interval);this._interval=0},interval:function(){var e=this.caculate();this.$el.find(".dd").text(e.day);this.$el.find(".hh").text(e.hour);this.$el.find(".mm").text(e.mini);this.$el.find(".ss").text(e.sec);this.$el.find(".ms").text(e.msec);if(e.dur<=0){this.stop();this.$el.trigger("countdownover")}}};c.exports=d});M.define("/js/sales/stock-v2",function(c,b,e){var a=c("/js/localdeals/rest");var g=function(i){this.attributeSelection={};this.sku={};this.dom=i;this.rangeBeginDate="";this.rangeEndDate="";this.num={};this.numRange={};this.attributes={};this.Interval=0;this.nextMonth=0};g.prototype={init:function(i){var j=this,k=this.dom;this.skuService=new h(i);$(k.btnAttributeValue).each(function(){var m=$(this).data("aId"),l=$(this).data("avId");if(!j.attributes[m]){j.attributes[m]=[]}j.attributes[m].push(l)})},bindEvent:function(){var i=this,k=this.dom,j=$("body");$(k.btnAttributeValue).on("click",function(){var n=$(this),m=n.data("aId"),l=n.data("avId");if(n.hasClass("disabled")||n.hasClass("on")){return false}i.selectAttribute(m,l);i.disableOthers(m,l);n.addClass("on").siblings("[data-a-id]").removeClass("on disabled")});$(k.rangeTextBegin).on("click",function(){$(k.rangeCalBegin).toggle();$(this).toggleClass("on");$(k.rangeCalEnd).hide();$(k.rangeTextEnd).removeClass("on")});$(k.rangeTextEnd).on("click",function(){$(k.rangeCalEnd).toggle();$(this).toggleClass("on");$(k.rangeCalBegin).hide();$(k.rangeTextBegin).removeClass("on");if(i.nextMonth!=0){$(k.rangeCalEnd).find('[data-number="'+i.nextMonth+'"]').trigger("click")}});j.on("click",k.rangeCalTab,function(){var l=$(this).data(k.rangeCalTabData);$(this).closest(k.rangeCalWrap).find(k.rangeCalPanel).hide().eq(l).show();$(this).addClass("on").siblings(k.rangeCalTab).removeClass("on")});j.on("click",k.rangeCalSelect,function(){var l=$(this).data(k.rangeCalSelectData);if($(this).data("disabled")){return false}if($(this).closest(k.rangeCalBegin).length){i.selectRangeBegin(l);i.totalData(moment(i.rangeBeginDate),moment(i.rangeEndDate));$(k.rangeTextBegin).removeClass("on").html(l+"<i></i>");$(k.rangeCalBegin).hide()}else{i.selectRangeEnd(l);i.totalData(moment(i.rangeBeginDate),moment(i.rangeEndDate));$(k.rangeTextEnd).removeClass("on").html(l+"<i></i>");$(k.rangeCalEnd).hide()}i.calNumRange();i.calTotalPrice()});j.on("click",k.numSelectBtn,function(){var m=$(this).data("id"),l=$(this).data("defId");if(!l){return false}if(!i.num.hasOwnProperty(l)){i.num[l]=1}if(m=="plus"){i.num[l]=i.num[l]+1}else{if(i.num[l]>0){i.num[l]=i.num[l]-1}}i.calNumRange();i.calTotalPrice()});$(k.bookingBtn).on("click",function(){var m=i.checkForBooking();if(m!==true){mAlert(m);return false}var n={num:i.num,stock_id:i.sku.id,begin_date:i.rangeBeginDate,end_date:i.rangeEndDate,room_num:0},l="/sales/booking.php?";l+=$.param(n);location.href=l});$(k.bookingBtnSide).on("click",function(){$("html, body").animate({scrollTop:0},300)})},totalData:function(j,i){if(i>j){this.Interval=Math.floor((i-j)/(24*3600*1000))+1;$(this.dom.rangeMinSelect).text("å…±"+this.Interval+"å¤©")}},autoSelectAttribute:function(){var i=this.dom;$(i.btnAttribute).each(function(){var j=$(this);setTimeout(function(){j.find(i.btnAttributeValue).not(".disabled").eq(0).trigger("click")},0)})},renderCalendar:function(){var i=this.skuService.getData(this.sku.id),j=this;$(this.dom.rangeMinSelect).text("æœ€å°‘é¢„è®¢"+this.sku.range_min_length+"å¤©");$(this.dom.rangeCalBegin).html(i.html);$(this.dom.rangeCalEnd).html(i.html).find(this.dom.rangeCalSelect).each(function(){var k=$(this).data(j.dom.rangeCalSelectData);if(k<j.nearestEndDate){$(this).data("disabled",1).removeClass("have").find(".border, .pro").hide()}else{if($(this).data("disabled")){$(this).data("disabled",0).addClass("have").find(".border, .pro").show()}}});if(this.rangeBeginDate&&this.rangeEndDate){$(this.dom.rangeTextBegin).html(this.rangeBeginDate+"<i></i>");$(this.dom.rangeTextEnd).html(this.rangeEndDate+"<i></i>")}$(this.dom.rangeSelection).show()},renderNumSelect:function(){var i=this.skuService.getData(this.sku.id),k=i.def.b,j=this;$(this.dom.numSelect).hide();_.each(k,function(l){$("["+j.dom.numSelectAttr+"="+l.id+"]").show().find(j.dom.numInput).text(j.num[l.id])})},renderTotalPrice:function(){$(this.dom.flagTotalPrice).show();if(this.totalPrice>0){$(this.dom.textTotalPrice).text(this.totalPrice)}else{$(this.dom.textTotalPrice).text("--")}},selectAttribute:function(j,k){var i;this.attributeSelection[j]=k;i=this.skuService.findSku(this.attributeSelection);if(i&&i.id!=this.sku.id){this.targetedSku(i)}},disableOthers:function(i,j){var k=this.skuService.findAttributeValueIds(j),l=[];$("[data-a-id]").each(function(){var m=$(this),o=m.data("aId"),n=m.data("avId");if(o==i){return true}if(!_.contains(k,n)){if(m.hasClass("on")){m.removeClass("on");l.push(o)}m.addClass("disabled")}else{m.removeClass("disabled")}});window.setTimeout(function(){if(l.length){_.each(l,function(m){$('[data-a-id="'+m+'"]:not(.disabled)').eq(0).trigger("click")})}l=[]},0)},selectRangeBegin:function(i){this.rangeBeginDate=i;this.nearestEndDate=d.getRangeEnd(i,this.sku.range_min_length,true);var j=moment(this.nearestEndDate).year(),k=moment(this.nearestEndDate).month()+1;this.nextMonth=j+"-"+k;this.renderCalendar()},selectRangeEnd:function(i){this.rangeEndDate=i},setDefaultRange:function(){var j=this.skuService.getData(this.sku.id),l=j.calendar,k=j.data,i,m;_.some(l,function(n){i=_.find(n.days,function(o){var p=k[o.date];return o.date&&p&&(!p.is_unlimited&&p.remain||p.is_unlimited)});return i});if(i){m=d.getRangeEnd(i.date,this.sku.range_min_length,true)}if(i&&m){this.rangeBeginDate=i.date;this.rangeEndDate=m}},setDefaultNum:function(){var k=this.skuService.getData(this.sku.id),i=k.def.b,l={},j=this;_.each(i,function(m){if(j.num.hasOwnProperty(m.id)){l[m.id]=j.num[m.id]}else{l[m.id]=1}});this.num=l},targetedSku:function(j){var i=this;this.sku=j;if(!this.skuService.isCached(this.sku.id)){a.getMulti("/sales/stockv2",{type:"calendar",sku_id:this.sku.id},{},function(k){if(!k.errno){i.skuService.addCache(j.id,k.data.list);i.setDefaultNum();i.renderCalendar();i.calNumRange();i.calTotalPrice()}},"default")}else{i.setDefaultNum();i.renderCalendar();i.calNumRange();i.calTotalPrice()}},calTotalPrice:function(){var i=this.skuService.getData(this.sku.id),j=this;this.totalPrice=0;_.each(this.num,function(l,k){d.travel(j.rangeBeginDate,j.rangeEndDate,function(m,n){var o=new Decimal(i.data[n].list[k].price_sold);j.totalPrice=o.times(l).plus(j.totalPrice)})});this.renderTotalPrice()},calNumRange:function(){var i=this.skuService.getData(this.sku.id),j=this;_.each(this.num,function(m,l){var n=1,k=99;d.travel(j.rangeBeginDate,j.rangeEndDate,function(o,q){var p=i.data[q].list[l];if(!p.is_unlimited){k=k>p.remain?p.remain:k}});if(k===0){n=0}j.numRange[l]={min:n,max:k};if(m<n){j.num[l]=n}if(m>k){j.num[l]=k}});this.renderNumSelect()},checkForBooking:function(){if(!_.size(this.num)){return"è¯·é€‰æ‹©æ•°é‡"}if(!this.rangeBeginDate){return"è¯·é€‰æ‹©èµ·å§‹æ—¥æœŸ"}if(!this.rangeEndDate){return"è¯·é€‰æ‹©ç»“æŸæ—¥æœŸ"}if(this.totalPrice==0){return"è¯·é‡æ–°é€‰æ‹©æ—¥æœŸ"}return true}};var h=function(i){if(i.length){var j=this;this.codeMap=_.indexBy(i,"code");this.attributeValueIds={};_.each(i,function(l){var k=l.code.split("|");j.attributeValueIds[l.code]=[];_.each(k,function(m){j.attributeValueIds[l.code].push(1*m.split(":")[1])})})}this.cache={}};h.prototype={findSku:function(i){var k=_.keys(i).sort(function(m,l){return m-l});var j=_.map(k,function(l){return l+":"+i[l]}).join("|");return this.codeMap[j]||false},findAttributeValueIds:function(j){var i=[];_.each(this.attributeValueIds,function(k){if(_.contains(k,j)){i=i.concat(k)}});return _.unique(i)},isCached:function(i){return this.cache.hasOwnProperty(i)},addCache:function(j,i){this.cache[j]=i},getData:function(i){return this.cache[i]}};var d={travel:function(k,m,i){var l=moment(k).clone().startOf("day"),j=moment(m).clone().startOf("day");while(l.diff(j)<=0){if(_.isFunction(i)){i(l,l.format("YYYY-MM-DD"))}l=l.add(1,"days")}},getRangeEnd:function(k,j,i){j=i?j-1:j;return moment(k).add(j,"day").format("YYYY-MM-DD")}};function f(i){return(parseFloat(i).toFixed(2))}e.exports=g});M.define("Pagination",function(b,a,c){b("jq-tmpl");function d(e){this.total=null;this.pageSize=null;this.currPage=null;this.pageDisplayNum=null;this.callback=null;this.tmpl=null;this.container=null;this.pageItemClass="_j_pageitem";this.jumperBtnClass="_j_jumperbtn";this.jumperInputClass="_j_jumperinput";this.loadInitPage=false;this.evenOffset=-1;M.mix(this,e);this.total=+this.total;this.pageSize=this.pageSize>0?(+this.pageSize):10;this.currPage=this.currPage>0?(+this.currPage):1;this.pageDisplayNum=this.pageDisplayNum>0?(+this.pageDisplayNum):5;this.container=$(this.container);if(this.total<0||!this.tmpl.length||!this.container.length){M.error("pagination param invalid")}this.init()}M.mix(d.prototype,{init:function(){if(this.loadInitPage){this.loadPage(this.currPage)}else{this.drawPage()}this.bindEvents()},drawPage:function(){var g={total:this.total,currPage:this.currPage,pageSize:this.pageSize,pageDisplayNum:this.pageDisplayNum};var e=Math.ceil(this.total/this.pageSize);g.pageTotal=e;if(e<=this.pageDisplayNum){g.indexers=this.makeIndex(1,e)}else{if(this.currPage>e){this.currPage=e}var f=(this.pageDisplayNum-1)/2;if(f!==parseInt(f,10)){f=this.evenOffset>0?Math.floor(f)+this.evenOffset:Math.ceil(f)+this.evenOffset}var h=this.pageDisplayNum-1-f;if(this.currPage-f<1){f=this.currPage-1;h=this.pageDisplayNum-1-f}else{if(this.currPage+h>e){h=e-this.currPage;f=this.pageDisplayNum-1-h}}g.indexers=this.makeIndex(this.currPage-f,this.pageDisplayNum)}this.container.empty().append($(this.tmpl).tmpl(g))},loadPage:function(e){this.currPage=e;this.drawPage();this.container.trigger("pagechanged",[{index:e}]);if(typeof this.callback=="function"){this.callback(e)}},bindEvents:function(){this.container.undelegate("click");this.container.undelegate("keydown");this.container.on("click","."+this.pageItemClass,M.bind(function(f){var g=$(f.currentTarget),e=g.data("page");this.loadPage(e);f.preventDefault()},this));this.container.on("click","."+this.jumperBtnClass,M.bind(function(f){var g=$(f.currentTarget),e=+this.container.find("."+this.jumperInputClass).val();f.preventDefault();if(e<=0||e>Math.ceil(this.total/this.pageSize)){alert("è¯·è¾“å…¥æœ‰æ•ˆçš„é¡µç ");return false}this.loadPage(e)},this));this.container.on("keydown","."+this.jumperInputClass,M.bind(function(e){if(e.keyCode==13){this.container.find("."+this.jumperBtnClass).trigger("click")}},this))},makeIndex:function(h,f){var e=[];for(var g=h;g<h+f;g++){e.push(g)}return e}});c.exports=d});M.define("/js/sales/deals",function(c,b,d){var a=c("/js/localdeals/rest");var e=function(f){this.config=$.extend(true,{},this.config,f)};e.EVENT_LOAD_LIST="sales_deals_load_list";e.prototype={config:{salesId:0,pageNums:6},init:function(){this.loadList(1)},pagination:null,trigger:function(f,g){$(document).trigger(f,g)},loadList:function(i){if(!$("#payment_page_box").length){return}var h=this;var f={sales_id:this.config.salesId};var g={no:i,num:this.config.pageNums,mode:"random_total"};$(".com-list").css("visibility","hidden");a.getMulti("/sales/order/",f,g,function(k){if(k.errno){h.alert(errno)}else{var j=$("#tb_payment").find("tbody").empty();$.each(k.data.list,function(n,m){j.append(m)});j.css("visibility","visible");if(!h.pagination){var l=c("Pagination");h.pagination=new l({total:k.data.page.data_total,pageSize:k.data.page.num,pageDisplayNum:6,container:$("#payment_page_box").empty(),tmpl:"#sales_pagination",callback:function(m){h.loadList(m)}})}if(h.pagination.total!=k.data.page.data_total||h.pagination.currPage!=k.data.page.no){h.pagination.total=k.data.page.data_total;h.pagination.currPage=k.data.page.no;h.pagination.drawPage()}h.trigger(e.EVENT_LOAD_LIST)}},"html","www")}};d.exports=e});M.define("/js/sales/map",function(b,a,c){var d=function(e){this.config=$.extend(true,{},this.config,e)};d.prototype={$sidebar:null,config:{trigger:".a-maps",closeBtn:"#btn_close_map",dialog:"#pnl_mappop",mapWrapper:"#hotel_map_box",resizeEvents:[]},_map:null,_marker:null,init:function(){var e=0;var f=this;$(this.config.trigger).on("click",function(){var g=$(this),j=g.offset().top,i=g.offset().left;var h=g.data();$(f.config.dialog).css({top:j,left:i-233}).show();if(e===0){e=1;var k=new MfwMapLoad(function(){f.setMarker(h.lat,h.lng,h.name);e=2},6000,false);k.loadGoogleMap()}else{if(e===1){var l=setInterval(function(){if(e===2){clearInterval(l);f.setMarker(h.lat,h.lng,h.name)}},500)}else{f.setMarker(h.lat,h.lng,h.name)}}});$(this.config.closeBtn).on("click",function(){$(f.config.dialog).hide()})},getMap:function(f){if(!f){return this._map}var e={center:f,zoom:14,panControl:true,scaleControl:true,disableDefaultUI:true,zoomControl:true,mapTypeId:google.maps.MapTypeId.ROADMAP};e.styles=[{featureType:"all",stylers:[{saturation:-28}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#ffffff"},{saturation:50}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#cccccc"},{saturation:-25}]},{featureType:"poi.business",elementType:"labels",stylers:[{visibility:"off"}]}];if(this._map){this._map.setOptions(e)}else{this._map=new google.maps.Map($(this.config.mapWrapper).get(0),e)}return this._map},setMarker:function(g,e,h){var i=new google.maps.LatLng(parseFloat(g),parseFloat(e));var f={position:i,map:this.getMap(i),title:h,icon:location.protocol+"//images.mafengwo.net/images/hotel/map_marker_red.png"};if(this._marker){this._marker.setOptions(f)}else{this._marker=new google.maps.Marker(f)}}};c.exports=d});M.define("/js/sales/slider",function(c,b,d){var a=function(){};a.prototype={_index:0,_length:0,_autoPlayInterval:0,_autoPlayId:0,_autoPlayPause:false,_itemWidth:0,$list:null,$wrapper:null,sliderDom:[],init:function(f){var e=this;this.sliderDom=f;this.$list=$(this.sliderDom);this._length=this.$list.length;this.$wrapper=this.$list.parent();this._index=0;this._itemWidth=this.$list.eq(0).width();this.$wrapper.width(this._itemWidth*this._length);$(this.$wrapper.siblings(".btn-next")).click(function(){e.next(e.sliderDom)});$(this.$wrapper.siblings(".btn-prev")).click(function(){e.prev(e.sliderDom)});$(this.$wrapper).on("mouseenter",function(){e._autoPlayPause=true}).on("mouseleave",function(){e._autoPlayPause=false})},next:function(){var e=this._index+1;if(e>=this._length){e=0}this.setIndex(e)},prev:function(){var e=this._index-1;if(e<0){e=this._length-1}this.setIndex(e)},setIndex:function(e){this.$wrapper.stop().animate({"margin-left":-e*this._itemWidth},200);this._index=e;$(this.$wrapper.siblings(".dot")).children().removeClass("on").eq(e).addClass("on")},autoPlay:function(e){var f=this;this._autoPlayInterval=e;window.setTimeout(function(){if(!f._autoPlayPause){f.next()}window.setTimeout(arguments.callee,e)},e)}};d.exports=a});function get_connect_share_js(e,h,f,d,c){var g="";if(e=="sina"){if("object"===typeof f){f=f.sina}if(f!=""){h=f.substr(0,140)}var b="http://service.weibo.com/share/share.php?appkey=82015185&title="+encodeURIComponent(h)+"&pic="+encodeURIComponent(c)+"&url="+encodeURIComponent(d)+"&ralateUid=1730714982";g="window.open('"+b+"','_blank','scrollbars=no,width=600,height=480,left=75,top=20,status=no,resizable=yes');"}else{if(e=="renren"||e=="xiaonei"){if("object"===typeof h){h=h.renren}if("object"===typeof f){f=f.renren}var a={resourceUrl:d,pic:c,title:h,description:f};shareClick(a)}else{if(e=="qzone"||e=="qq"){if("object"===typeof h){h=h.qq}if("object"===typeof f){f=f.qq}g="window.open('http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?title="+encodeURIComponent(h)+"&summary="+encodeURIComponent(f)+"&pics="+encodeURIComponent(c)+"&site="+encodeURIComponent("èš‚èœ‚çª")+"&url="+encodeURIComponent(d)+"','_blank','scrollbars=no,width=600,height=450,left=75,top=20,status=no,resizable=yes');"}else{return false}}}return g}function sns_share_show(e,g,f,d,c,a){var h=e.split("_")[0];if("object"===typeof f){f=f[h]}if(typeof(ata)!="undefined"){ata("sn")}if(h=="wb"){if(f!=""&&f!=undefined){f=f.substr(0,140)}var b="http://www.mafengwo.cn/connect_share.php?key="+e+"&title="+encodeURIComponent(g)+"&content="+encodeURIComponent(f)+"&url="+encodeURIComponent(d)+"&pic="+encodeURIComponent(c);return'window.open("'+b+'", "_blank", "scrollbars=no,width=600,height=480,left=75,top=20,status=no,resizable=yes");'}else{if(h=="rr"){var b="http://www.mafengwo.cn/connect_share.php?key="+e+"&title="+encodeURIComponent(g)+"&content="+encodeURIComponent(f)+"&url="+encodeURIComponent(d)+"&pic="+encodeURIComponent(c);return'window.open("'+b+'", "_blank", "scrollbars=no,width=700,height=650,left=75,top=20,status=no,resizable=yes");'}else{if(h=="qz"){var b="http://www.mafengwo.cn/connect_share.php?key="+e+"&title="+encodeURIComponent(g)+"&content="+encodeURIComponent(f)+"&url="+encodeURIComponent(d)+"&pic="+encodeURIComponent(c);return'window.open("'+b+'", "_blank", "scrollbars=no,width=600,height=450,left=75,top=20,status=no,resizable=yes");'}else{if(h=="qt"){var b="http://www.mafengwo.cn/connect_share.php?key="+e+"&title="+encodeURIComponent(g)+"&content="+encodeURIComponent(f)+"&url="+encodeURIComponent(d)+"&pic="+encodeURIComponent(c);return'window.open("'+b+'", "_blank", "scrollbars=no,width=700,height=680,left=75,top=20,status=no,resizable=no,menubar=no,toolbar=no,scrollbars=no,location=yes");'}else{if(h=="ww"){var b="http://www.mafengwo.cn/connect_share.php?key="+e+"&title="+encodeURIComponent(g)+"&content="+encodeURIComponent(f)+"&url="+encodeURIComponent(d)+"&pic="+encodeURIComponent(c)+"&tag="+encodeURIComponent(a);return'window.open("'+b+'", "_blank", "scrollbars=no,width=660,height=550,left=75,top=20,status=no,resizable=no,menubar=no,toolbar=no,scrollbars=no,location=yes");'}}}}}}if("M" in window&&"define" in M){M.define("/js/m.sns.share",function(){return sns_share_show})}M.define("/js/sales/share",function(require,exports,module){var SalesShare=function(config){this.config=$.extend(true,{},this.config,config)};SalesShare.prototype={config:{salesId:0,title:"",description:"",url:"",img:""},toWeibo:function(){var sns_share_show=require("/js/m.sns.share");eval(sns_share_show("wb_tinfo_1",this.config.title,this.config.title,this.config.url,this.config.img));this._record("sina")},toQzone:function(){var sns_share_show=require("/js/m.sns.share");eval(sns_share_show("qz_tinfo_1",this.config.title,this.config.title,this.config.url,this.config.img));this._record("qq")},toWeixin:function(){$("#popup_container2").show();this._record("weixin")},_record:function(type){var params={act:"shareSales",sales_id:this.config.salesId,share_type:type};$.getJSON("/sales/ajax.php",params)}};return module.exports=SalesShare});M.define("/js/sales/favorite",function(c,b,d){var a=function(e){this.config=$.extend(true,{},this.config,e)};a.prototype={config:{},add:function(e,f,g){return mfwRest.post("/sales/favorite",{action:"add",data_id:e,type:f},function(h){g(h)},"default","message")},remove:function(e,f,g){return mfwRest.post("/sales/favorite",{action:"remove",data_id:e,type:f},function(h){g(h)})},list:function(){throw new Error("undefined method")}};return d.exports=a});M.define("/js/sales/comment",function(c,b,d){var a=c("/js/localdeals/rest");var e=function(f){this.config=$.extend(true,{},this.config,f);if(!this.config.uid){this.config.uid=window.Env.UID|0}};e.TYPE_ALL=0;e.TYPE_PRODUCT=1;e.TYPE_TRANSFER=2;e.TYPE_REVIEW=3;e.TYPE_FAQ="faq";e.EVENT_LOAD_LIST="sales_comment_load_list";e.EVENT_LOAD_REPLIES="sales_comment_load_replies";e.EVENT_ADD_REPLY="sales_comment_add_reply";e.EVENT_ADD_COMMENT="sales_comment_add_comment";e.EVENT_IMAGE_LOAD="sales_comment_image_load";e.prototype={config:{salesId:0,uid:0},currentType:e.TYPE_ALL,currentPage:1,referId:0,editor:null,init:function(){var g=this;this.loadList(e.TYPE_ALL,1);var f=$("#target_ask");f.find(".tab a").click(function(){var h=$(this).data("type");if(h!=g.currentType){g.loadList(h,1)}});f.on("click",'[data-act="refer"],[data-act="reply"],[data-act="add"]',function(){var l=$(this).data("act"),j,m,i=0,k=0;if(l!="add"){var h=$(this).closest("[data-id]");i=h.data("id")|0;k=h.data("uid")|0;j=h.data("name");m=h.find(".avatar img").eq(0).attr("src")}else{j=$(this).data("name");m=$(this).data("logo")}g.openDialog(l,i,k,j,m)});$(".consult-popup .close,.consult-popup .cancel").click(function(){g.closeDialog()});$(".consult-popup [name=type]").change(function(){$(".consult-popup .q-tag").html(g.getTypeName())});this.editor=$(".consult-popup textarea").mfweditor({width:"200px",css:"",autoGrow:false,controls:{insertImage:{visible:true},insertWengImage:{visible:false},insertVideo:{visible:false},saveContent:{visible:false},clearContent:{visible:false},callName:{visible:false}}}).data("mfweditor");$(".consult-popup .ok").click(function(){g.submit()})},alert:function(f){if("mTinyAlert" in window){window.mTinyAlert(f)}else{alert(f)}},trigger:function(f,g){$(document).trigger(f,g)},loadList:function(h,j){var i=this;if(!arguments.length){h=i.currentType;j=i.currentPage}else{i.currentType=h;i.currentPage=j}$(".com-tab a").removeClass("on").filter("[data-type="+h+"]").addClass("on");var f={sales_id:this.config.salesId,type:h};var g={no:j,mode:"random_total"};$(".com-list").css("visibility","hidden");a.getMulti("/sales/consults/",f,g,function(l){if(l.errno){i.alert(l.error)}else{var k=$(".com-list").empty();if(l.data.page.data_total){$(".m-consult .empty-msg").hide();$.each(l.data.list,function(n,m){k.append(m)});k.css("visibility","visible");$("#comment_page_box").pagination("destroy").pagination({page:l.data.page.no,total:l.data.page.data_total,item_size:l.data.page.num,callback:function(m){var n=$("#target_comment");$(window).scrollTop(n.offset().top);i.loadList(i.currentType,m)}});k.find("img").on("load",function(){i.trigger(e.EVENT_IMAGE_LOAD)});i.trigger(e.EVENT_LOAD_LIST)}else{$(".m-consult .empty-msg").show()}}},"html","www")},loadReplies:function(){},openDialog:function(j,g,h,f,k){$(".consult-popup").show();if(j=="add"){$(".consult-popup .addons").show();$(".consult-popup .q-tag").html(this.getTypeName())}else{$(".consult-popup .addons").hide();$(".consult-popup .q-tag").html("å›žå¤")}$(".consult-popup .user .name").text(f);$(".consult-popup .user .avatar").attr("src",k);if(g!=this.referId){var i="";if(g){i="å›žå¤"+f+"ï¼š"}$(".consult-popup textarea").val(i);this.editor.setContent(i);$(".consult-popup .ok").html("å›žå¤")}else{$(".consult-popup .ok").html("æé—®")}this.referId=g},getType:function(){return $(".consult-popup [name=type]:checked").val()},getTypeName:function(){return $.trim($(".consult-popup [name=type]:checked").parent().text())},closeDialog:function(){$(".consult-popup").hide()},submit:function(){var g=this;if(!this.config.uid){M.Event.fire("login:required")}else{var f=this.referId;var h={content:this.editor.getContent(),sales_id:this.config.salesId,type:this.getType(),refer_id:this.referId};a.post("/sales/consults",h,function(i){if(i.errno){g.alert(i.error)}else{if(f!=0){$('.com-list [data-id="'+f+'"]').closest(".con-item").find(".reply").append(i.data.after).show();$(document).trigger(e.EVENT_ADD_REPLY)}else{g.loadList(g.currentType,1);$(document).trigger(e.EVENT_ADD_COMMENT)}g.closeDialog()}},"default","html","www")}}};d.exports=e});M.define("/js/sales/review",function(c,b,d){var a=c("/js/localdeals/rest");var e=function(f){this.config=$.extend(true,{},this.config,f)};e.EVENT_LOAD_LIST="sales_review_load_list";e.prototype={config:{salesId:0},currentPage:1,currentStar:0,init:function(){var f=this;this.loadList(0,1);$(".m-reviews a").click(function(){var g=$(this).data("star");if(f.currentStar!=g){f.loadList(g,1);$(this).parent().addClass("on").siblings().removeClass("on")}})},alert:function(f){if("mTinyAlert" in window){window.mTinyAlert(f)}else{alert(f)}},trigger:function(f,g){$(document).trigger(f,g)},loadList:function(j,i){var h=this;if(!arguments.length){j=h.currentStar;i=h.currentPage}else{h.currentStar=j;h.currentPage=i}var f={sales_id:this.config.salesId,star:j};var g={no:i,mode:"random_total"};$(".rev-list").css("visibility","hidden");a.getMulti("/sales/order/review/",f,g,function(l){if(l.errno){h.alert(l.error)}else{var k=$(".rev-list").empty();if(l.data.page.data_total){$(".m-reviews .empty-msg").hide();$.each(l.data.list,function(n,m){k.append(m)});k.css("visibility","visible");h.trigger(e.EVENT_LOAD_LIST)}else{$(".m-reviews .empty-msg").show()}$("#review_page_box").pagination("destroy").pagination({page:l.data.page.no,total:l.data.page.data_total,item_size:l.data.page.num,callback:function(m){var n=$("#target_review");$(window).scrollTop(n.offset().top);h.loadList(h.currentStar,m)}})}},"html","www")}};d.exports=e});M.define("/js/sales/detail",function(c,b,d){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(f){var e=this.length>>>0;var g=Number(arguments[1])||0;g=(g<0)?Math.ceil(g):Math.floor(g);if(g<0){g+=e}for(;g<e;g++){if(g in this&&this[g]===f){return g}}return -1}}var a=function(e){this.config=$.extend(true,{},this.config,e)};a.EVENT_WINDOW_RESIZE="sales_detail_window_resize";a.EVENT_CHANGE_TAB="sales_detail_change_tab";a.EVENT_EXPAND="sales_detail_expand";a.EVENT_IS_UNKNOW_TRAVEL_SOLDOUT="sales_detail_unknow_travel_soldout";a.prototype={config:{sales:{id:0,name:"",img:"",scope:"sales",is_unknow_travel:false},allow_comment:true,allow_show_review:true,allow_show_deal:true,gift_code:""},resizeEvents:[a.EVENT_CHANGE_TAB,a.EVENT_EXPAND,a.EVENT_IS_UNKNOW_TRAVEL_SOLDOUT],_resizeEvents:"",_triggetIntervalId:0,slider:null,stock:null,cart:null,share:null,comment:null,deals:null,map:null,sliderDom:[".sales-photo ul",".detail-photo ul"],formLock:false,init:function(){var j=this;this.initSlider();this.initEvent();this.initDropMenu();var h=c("/js/sales/navbar");new h({anchors:".main-detail .nav-anchor",resizeEvents:[a.EVENT_WINDOW_RESIZE]}).init();var i=c("/js/sales/sidebar");new i({resizeEvents:[a.EVENT_WINDOW_RESIZE]}).init();var m=c("/js/sales/cart-v2");this.regResizeEvent([m.EVENT_ADD_ITEM,m.EVENT_REMOVE_ITEM]);this.cart=new m({scope:this.config.sales.scope,salesId:this.config.sales.id});this.cart.init();var e=c("/js/sales/countdown");var n=new e(".not-start");$(".not-start").eq(0).on("countdownover",function(){$(".on-countdown-show").hide();$(".on-countdown-hide").show()});if(this.config.stock_version==1){var k=c("/js/sales/stock-v2");var l=new k({btnAttribute:"[data-sku-attr]",btnAttributeValue:".ui-selProp>li",rangeSelection:"#calendar_range",rangeTextBegin:"#range_text_begin",rangeTextEnd:"#range_text_end",rangeCalWrap:".sales-calendar",rangeCalBegin:"#range_cal_begin",rangeCalEnd:"#range_cal_end",rangeCalTab:"[data-range-cal-tab]",rangeCalPanel:"[data-range-cal-panel]",rangeCalTabData:"rangeCalTab",rangeCalSelect:"[data-cal-select]",rangeCalSelectData:"calSelect",rangeMinSelect:"[data-range-min]",numSelect:"[data-num-select]",numSelectAttr:"data-num-select",numInput:"[data-num-input]",numSelectBtn:"[data-num-select-btn]",flagTotalPrice:"#flag_total_price",textTotalPrice:"#text_total_price",bookingBtn:"[data-booking-btn-v2]",bookingBtnSide:"[data-booking-btn-v2-side]"});l.init(this.config.sku_list);l.bindEvent();l.autoSelectAttribute()}else{var g=c("/js/sales/stock");this.stock=new g({giftCode:this.config.gift_code,scope:this.config.sales.scope,isUnknowTravel:this.config.sales.is_unknow_travel,salesId:this.config.sales.id,calendarDisabledCss:"soldout",calendarScrollLeft:".cal-month>.tab-arrLeft",calendarScrollRight:".cal-month>.tab-arrRight",calendarPrev:".cal-month .arrow-prev",calendarNext:".cal-month .arrow-next",structureWrapper:"#stock_wrap, #sidebar_stock_wrapper",calendarWrapper:"#calendar_wrap",calendarBlock:"#calendar_wrap,#sidebar_calendar_block,#top_calendar_block",sidebarCalendarWrapper:"#sidebar_calendar_wrap,#top_calendar_wrap",rmbFlag:".total .rmb-flag,.price-total .rmb-flag",totalPriceSelector:".action-panel .total strong,.m-book .price-total span",remainSpan:".stock-remain span",adultNumSpan:".price-adult .num, .amount-adult .num",adultPriceSpan:".price-adult .price, .amount-adult .price",kidAmountBlock:".amount-kid",kidBlock:".price-kid",kidNumSpan:".price-kid .num, .amount-kid .num",kidPriceSpan:".price-kid .price, .amount-kid .price",infantAmountBlock:".amount-infant",infantBlock:".price-infant",infantNumSpan:".price-infant .num, .amount-infant .num",roomAmountBlock:".amount-room",roomBlock:".price-room",roomNumSpan:".price-room .num, .amount-room .num",singleRoomBlock:".price-sg-room",singleRoomPriceSpan:".amount-room .price",singleRoomTotalPriceSpan:".price-sg-room .total-price",buyButton:".action-panel .buy .btn:not(.btn-disabled), .m-book .buy .btn:not(.btn-disabled)",bargainButton:".action-panel .bargain .btn:not(.btn-disabled), .m-book .bargain .btn:not(.btn-disabled)"});$(document).on(g.EVENT_SOLD_OUT,function(){$(".action-panel .buy .btn, .m-book .buy .btn").addClass("btn-disabled").html("å”®ç½„")});this.regResizeEvent([g.EVENT_SELECT_NODE,g.EVENT_CHANGE_CALENDAR,g.EVENT_CHANGE_MONTH]);$(document).on(g.EVENT_SELECT_DATE,function(q,p){$(".top-bar .bookDate-trigger .label").html(p)});$(document).on(g.EVENT_SELECT_NODE,function(s,r){if(r&&r.level==0){var q=r.sellingTime;if(q!==undefined&&!r.saleOnBefore){var p=n.setTargetTime(q);if(p){$(".on-countdown-show").show();$(".on-countdown-hide").hide()}else{$(".on-countdown-show").hide();$(".on-countdown-hide").show()}}else{$(".on-countdown-show").hide();$(".on-countdown-hide").show()}}if(j.config.sales.is_unknow_travel&&r.remain==0){$(".unknow-travel-soldout-show").show();$(document).trigger(a.EVENT_IS_UNKNOW_TRAVEL_SOLDOUT)}});this.stock.init()}this.initShare();this.initFavorite();this.initComment();this.initReview();this.travelManager();this.initStatistics();if(this.config.allow_show_deal){var o=c("/js/sales/deals");this.regResizeEvent(o.EVENT_LOAD_LIST);this.deals=new o({salesId:this.config.sales.id});this.deals.init()}var f=c("/js/sales/map");this.map=new f();this.map.init();this.initLog()},travelManager:function(){var e=this;if(window.Env.bIsShowConnectWindow){setTimeout(function(){$("#Js_trvalM").removeClass("hide");$("#Js_traveTell").on("click",function(){var f=$(".Js_traveNum").val().trim();var g=verify_data(f,"phone");if(!g){mAlert("è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·");return false}var h={name:"å’¨è¯¢ç”¨æˆ·",phone:f,mdd_to:e.config.sales.name,data_id:window.Env.salesId,data_type:1,channel:1};if(!this.formLock){this.formLock=true;mfwRest.post("/sales/customize",h,function(i){if(i.errno){mAlert(i.error)}else{mAlert("æäº¤æˆåŠŸï¼Œç®¡å®¶ä¼šå°½å¿«è”ç³»ä½ ï¼");$("#Js_travrClose").trigger("click")}},"default")}return false});$("#Js_travrClose").on("click",function(){$("#Js_travalBlock").removeClass("hide");$(this).closest("#Js_trvalM").removeClass("contPopMoveOut").addClass("contPopMoveIn")});$("#Js_travalBlock").on("click",function(){$("#Js_trvalM").removeClass("contPopMoveIn").addClass("contPopMoveOut");$("#Js_travalBlock").addClass("hide")})},2000)}},initSlider:function(){var e=this;$.each(this.sliderDom,function(g,j){var h=$(j).length,f="";if(h>1){$(j).each(function(k,l){f=$(l).children("li");if(f.length>1){e.sliderAuto(f,null)}})}else{f=$(j).children("li");if(f.length>1){if($(j).data("type")=="salesPhoto"){e.sliderAuto(f,3000)}else{e.sliderAuto(f,null)}}}})},sliderAuto:function(g,f){var e=c("/js/sales/slider"),h=new e(),f=f||null;h.init(g);if(f){h.autoPlay(f)}},initShare:function(){var i=this;var g=c("/js/sales/share");var f=this.config.sales.name.replace(/ï¼ˆ.*ï¼‰/,"");this.share=new g({salesId:this.config.sales.id,title:"æŽ¨èä¸ªèš‚èœ‚çªè¶…èµžæ—…è¡Œäº§å“ï¼š"+f+"ã€‚è¶…å€¼æœ‰å“è´¨ï¼Œè‡ªç”±æœ‰ä¿éšœï¼Œä½ ä¹Ÿå¿«æ¥çœ‹çœ‹å§ï¼",img:this.config.sales.img,url:"http://www.mafengwo.cn/sales/"+this.config.sales.id+".html"});$(".s-weibo").click(function(){i.share.toWeibo()});$(".s-qzone").click(function(){i.share.toQzone()});$(".s-weixin").click(function(){i.share.toWeixin()});var e=$(".intro-l .share-icon");var h=0;$(".intro-l .share").on("mouseenter",function(){if(h){clearTimeout(h);h=0}e.fadeIn(500)}).on("mouseleave",function(){h=setTimeout(function(){e.fadeOut(500);clearTimeout(h)},500)})},initFavorite:function(){var g=this;var f=c("/js/sales/favorite");var e=new f();$(".btn-collect").click(function(){var h=$(this);if($(this).hasClass("on")){h.removeClass("on");e.remove(g.config.sales.id,1,function(j){if(j.errno){h.addClass("on");mTinyAlert(j.error)}else{var i=h.find(".num").html()|0;h.find(".num").html(i-1);mTinyAlert("å·²å–æ¶ˆæ”¶è—")}})}else{h.addClass("on");e.add(g.config.sales.id,1,function(j){if(j.errno){h.removeClass("on");mTinyAlert(j.error)}else{var i=h.find(".num").html()|0;h.find(".num").html(i+1);mTinyAlert("æ”¶è—æˆåŠŸ")}})}})},initComment:function(){if(this.config.allow_comment){var e=c("/js/sales/comment");this.regResizeEvent([e.EVENT_LOAD_LIST,e.EVENT_LOAD_REPLIES,e.EVENT_ADD_REPLY,e.EVENT_IMAGE_LOAD]);this.comment=new e({salesId:this.config.sales.id});this.comment.init()}},initReview:function(){if(this.config.allow_show_review){var f=c("/js/sales/review");this.regResizeEvent([f.EVENT_LOAD_LIST]);var e=new f({salesId:this.config.sales.id});e.init()}},initEvent:function(){var e=this;$(".main-detail img").on("load",function(){e._triggetResizeEvent()});$(window).on("resize",function(){e._triggetResizeEvent()});this.regResizeEvent(this.resizeEvents);$(".main-detail .tab").each(function(){var f=$(this).attr("data-event")||"click";$(this).children().on(f,function(){var g=$(this).index();$(this).addClass("on").siblings().removeClass("on");$(this).parent().nextAll(".list").hide().eq(g).show();$(this).trigger(a.EVENT_CHANGE_TAB)})});$(".crumb .drop").on("mouseenter",function(){$(this).addClass("open");var f=$(this).data("_hide");if(f){clearTimeout(f)}$(this).data("_hide",0)}).on("mouseleave",function(){var f=$(this);f.data("_hide",setTimeout(function(){f.removeClass("open");f.data("_hide",0)},300))});$(".expand-more").click(function(){$(this).closest(".react-expand").addClass("expanded");$(document).trigger(a.EVENT_EXPAND)});$(".poi-more").click(function(){$(".item-place").show();$(this).parent().remove();$(document).trigger(a.EVENT_EXPAND)});$(".react-expand:not(.expanded)").each(function(){if($(this).height()>=this.scrollHeight-18||location.search.indexOf("extend=1")>=0){$(this).addClass("expanded")}});$(".item-place .card").click(function(){var f=$(this).nextAll(".pop-place");if(f.is(":visible")){f.fadeOut(500)}else{$(".item-place .pop-place").not(f).hide();f.fadeIn(500)}});$(".item-place .pop-place .btn-close").click(function(){$(this).closest(".pop-place").fadeOut(500)});$(".bargain .i-tips").click(function(){var f=$(".bargain .tipspop");f.toggle()});$(".bargain .tipspop .close-btn").click(function(){$(".bargain .tipspop").hide()})},initStatistics:function(){$("[data-stat-area]").click(function(){var e=$(this).data("statArea"),f=$(this).data("statId");mfwPageEvent("sales","sales_info",{id:f,area:e,platform:"www"})})},regResizeEvent:function(e){var g=this;var h=e;if(typeof e=="string"){h=e.split(" ")}var f=false;$.each(h,function(k,j){if(g.resizeEvents.indexOf(j)<0){g.resizeEvents.push(j);f=true}});if(f){$(document).off(this._resizeEvents,this._triggetResizeEvent);this._resizeEvents=this.resizeEvents.join(" ");$(document).on(this._resizeEvents,this._triggetResizeEvent)}},_triggetResizeEvent:function(){var e=this;if(e._triggetIntervalId){clearTimeout(e._triggetIntervalId)}e._triggetIntervalId=setTimeout(function(){e._triggetIntervalId=0;$(document).trigger(a.EVENT_WINDOW_RESIZE)},100)},initDropMenu:function(){$(".ui-date").on("click",".trigger",function(){var e=$(this);var g=e.parent();var f=$(this).nextAll(".s_popup");if(f.is(":visible")){}else{f.show();g.addClass("drop-open");setTimeout(function(){$(document.body).on("click",function(i){var h=$(i.target);if(!h.closest(g).length||h.closest(e).length||h.closest("[data-stock-id]").length||h.is("[data-stock-id]")||h.is(".btn")){f.hide();g.removeClass("drop-open");$(document.body).off("click",arguments.callee)}})},0)}})},initLog:function(){try{$(".action-panel .buy .btn:not(.btn-disabled)").click(function(){mfwPageEvent("sales","detail_click",{pageId:window.Env.uPageId,button:"å¤´éƒ¨è´­ä¹°æŒ‰é’®",platform:"www"})});$(".m-book .buy .btn:not(.btn-disabled)").click(function(){mfwPageEvent("sales","detail_click",{pageId:window.Env.uPageId,button:"å³ä¾§è´­ä¹°æŒ‰é’®",platform:"www"})});$(".m-recommend a").click(function(){var h=$(this).closest("li").attr("data-stat-area");var g=$(this).closest("li").attr("data-stat-id");var e=$(this).closest("li").index()+1;mfwPageEvent("sales","detail_click",{pageId:window.Env.uPageId,button:h,platform:"www",uid:window.Env.UID,salesId:window.Env.salesId,recSalesId:g,position:e})})}catch(f){}}};d.exports=a});M.define("Storage",function(e,g,b){var n=document;var d=c();var f={_element:null,_expires:null,_file:document.location.hostname,init:function(){if(!this._element){try{this._element=n.createElement("input");this._element.type="hidden";this._element.addBehavior("#default#userData");n.body.appendChild(this._element);return{setItem:this.setItem,getItem:this.getItem,removeItem:this.removeItem}}catch(o){M.error(o)}}return true},setItem:function(r,s,p){var o=j(p);this._element.expires=o.toUTCString();this._element.load(this._file);var q=a(this._element.getAttribute(r)),t=i(s,+o);this._element.setAttribute(r,t);this._element.save(this._file);k({key:r,newValue:t,oldValie:q,url:window.location.href})},getItem:function(o){this._element.load(this._file);var p=a(this._element.getAttribute(o));return p&&p.value},removeItem:function(o){this._element.load(this._file);this._element.removeAttribute(o);this._element.save(this._file)}};var l={setItem:function(q,r,p){if(!d){return}var o=j(p);localStorage.setItem(q,i(r,+o))},getItem:function(o){if(!d){return}var q=+new Date(),p=a(localStorage.getItem(o));if(p){if(q>p.timestamp){localStorage.removeItem(o);p=null}else{p=p.value}}return p},removeItem:function(o){if(!d){return}localStorage.removeItem(o)}};var h={},m={on:function(p,q){var o=h[p]||(h[p]=[]);o.push(q)},off:function(p,q){var o=h[p];if(!!o){if(!!q){M.forEach(o,function(s,r){if(s==q){o.splice(r,1)}})}else{o=[]}}return this}};M.mix(f,m);M.mix(l,m);if(window.addEventListener){window.addEventListener("storage",k,false)}else{if(window.attachEvent){window.attachEvent("onstorage",k)}}function k(t){if(!t){t=window.event}var o=M.mix({},t),v=t.newValue&&a(t.newValue),p=t.oldValue&&a(t.oldValue),u=+new Date();o.newValue=v&&v.value;if(!!p&&u<p.timestamp){o.oldValue=p.value}else{o.oldValue=null}var s=t.key,r=h[s],q=0;if(!s||!r||0===r.length){return}while(q<r.length){r[q++].call(window,o)}}function j(o){if(Object.prototype.toString.call(o)!="[object Date]"){var p=typeof o==="number"&&o>0?o:86400;o=new Date();o.setTime(+o+p*1000)}return o}function i(p,o){var q={value:p,timestamp:o};return JSON.stringify(q)}function a(o){if(o){try{o=JSON.parse(o);if(!("value" in o)||!("timestamp" in o)){o={value:o,timestamp:+j()}}}catch(p){o={value:o,timestamp:+j()}}}return o}function c(){if(window.localStorage){try{localStorage.setItem("__detectLocalStorage",1);localStorage.removeItem("__detectLocalStorage");return true}catch(o){return false}}return false}b.exports=M.mix(window.localStorage?l:f.init(),{isAvailable:c})});(function(a){a.jGrowl=function(b,c){if(a("#jGrowl").size()==0){a('<div id="jGrowl"></div>').addClass((c&&c.position)?c.position:a.jGrowl.defaults.position).appendTo("body")}a("#jGrowl").jGrowl(b,c)};a.fn.jGrowl=function(b,d){if(a.isFunction(this.each)){var c=arguments;return this.each(function(){var e=this;if(a(this).data("jGrowl.instance")==undefined){a(this).data("jGrowl.instance",a.extend(new a.fn.jGrowl(),{notifications:[],element:null,interval:null}));a(this).data("jGrowl.instance").startup(this)}if(a.isFunction(a(this).data("jGrowl.instance")[b])){a(this).data("jGrowl.instance")[b].apply(a(this).data("jGrowl.instance"),a.makeArray(c).slice(1))}else{a(this).data("jGrowl.instance").create(b,d)}})}};a.extend(a.fn.jGrowl.prototype,{defaults:{pool:0,header:"",group:"",sticky:false,position:"top-right",glue:"after",theme:"default",themeState:"highlight",corners:"10px",check:250,life:3000,closeDuration:"normal",openDuration:"normal",easing:"swing",closer:true,closeTemplate:"&times;",closerTemplate:"<div>[ å…³é—­ ]</div>",log:function(c,b,d){},beforeOpen:function(c,b,d){},afterOpen:function(c,b,d){},open:function(c,b,d){},beforeClose:function(c,b,d){},close:function(c,b,d){},animateOpen:{opacity:"show"},animateClose:{opacity:"hide"}},notifications:[],element:null,interval:null,create:function(b,c){var c=a.extend({},this.defaults,c);if(typeof c.speed!=="undefined"){c.openDuration=c.speed;c.closeDuration=c.speed}this.notifications.push({message:b,options:c});c.log.apply(this.element,[this.element,b,c])},render:function(d){var b=this;var c=d.message;var e=d.options;var d=a('<div class="jGrowl-notification '+e.themeState+" ui-corner-all"+((e.group!=undefined&&e.group!="")?" "+e.group:"")+'"><div class="jGrowl-close">'+e.closeTemplate+'</div><div class="jGrowl-header">'+e.header+'</div><div class="jGrowl-message">'+c+"</div></div>").data("jGrowl",e).addClass(e.theme).children("div.jGrowl-close").bind("click.jGrowl",function(){a(this).parent().trigger("jGrowl.close")}).parent();a(d).bind("mouseover.jGrowl",function(){a("div.jGrowl-notification",b.element).data("jGrowl.pause",true)}).bind("mouseout.jGrowl",function(){a("div.jGrowl-notification",b.element).data("jGrowl.pause",false)}).bind("jGrowl.beforeOpen",function(){if(e.beforeOpen.apply(d,[d,c,e,b.element])!=false){a(this).trigger("jGrowl.open")}}).bind("jGrowl.open",function(){if(e.open.apply(d,[d,c,e,b.element])!=false){if(e.glue=="after"){a("div.jGrowl-notification:last",b.element).after(d)}else{a("div.jGrowl-notification:first",b.element).before(d)}a(this).animate(e.animateOpen,e.openDuration,e.easing,function(){if(a.browser.msie&&(parseInt(a(this).css("opacity"),10)===1||parseInt(a(this).css("opacity"),10)===0)){this.style.removeAttribute("filter")}a(this).data("jGrowl").created=new Date();a(this).trigger("jGrowl.afterOpen")})}}).bind("jGrowl.afterOpen",function(){e.afterOpen.apply(d,[d,c,e,b.element])}).bind("jGrowl.beforeClose",function(){if(e.beforeClose.apply(d,[d,c,e,b.element])!=false){a(this).trigger("jGrowl.close")}}).bind("jGrowl.close",function(){a(this).data("jGrowl.pause",true);a(this).animate(e.animateClose,e.closeDuration,e.easing,function(){a(this).remove();var f=e.close.apply(d,[d,c,e,b.element]);if(a.isFunction(f)){f.apply(d,[d,c,e,b.element])}})}).trigger("jGrowl.beforeOpen");if(e.corners!=""&&a.fn.corner!=undefined){a(d).corner(e.corners)}if(a("div.jGrowl-notification:parent",b.element).size()>1&&a("div.jGrowl-closer",b.element).size()==0&&this.defaults.closer!=false){a(this.defaults.closerTemplate).addClass("jGrowl-closer ui-state-highlight ui-corner-all").addClass(this.defaults.theme).appendTo(b.element).animate(this.defaults.animateOpen,this.defaults.speed,this.defaults.easing).bind("click.jGrowl",function(){a(this).siblings().trigger("jGrowl.beforeClose");if(a.isFunction(b.defaults.closer)){b.defaults.closer.apply(a(this).parent()[0],[a(this).parent()[0]])}})}},update:function(){a(this.element).find("div.jGrowl-notification:parent").each(function(){if(a(this).data("jGrowl")!=undefined&&a(this).data("jGrowl").created!=undefined&&(a(this).data("jGrowl").created.getTime()+parseInt(a(this).data("jGrowl").life))<(new Date()).getTime()&&a(this).data("jGrowl").sticky!=true&&(a(this).data("jGrowl.pause")==undefined||a(this).data("jGrowl.pause")!=true)){a(this).trigger("jGrowl.beforeClose")}});if(this.notifications.length>0&&(this.defaults.pool==0||a(this.element).find("div.jGrowl-notification:parent").size()<this.defaults.pool)){this.render(this.notifications.shift())}if(a(this.element).find("div.jGrowl-notification:parent").size()<2){a(this.element).find("div.jGrowl-closer").animate(this.defaults.animateClose,this.defaults.speed,this.defaults.easing,function(){a(this).remove()})}},startup:function(b){this.element=a(b).addClass("jGrowl").append('<div class="jGrowl-notification"></div>');this.interval=setInterval(function(){a(b).data("jGrowl.instance").update()},parseInt(this.defaults.check));if(a.browser.msie&&parseInt(a.browser.version)<7&&!window.XMLHttpRequest){a(this.element).addClass("ie6")}},shutdown:function(){a(this.element).removeClass("jGrowl").find("div.jGrowl-notification").remove();clearInterval(this.interval)},close:function(){a(this.element).find("div.jGrowl-notification").each(function(){a(this).trigger("jGrowl.beforeClose")})}});a.jGrowl.defaults=a.fn.jGrowl.prototype.defaults})(jQuery);if(window.M&&typeof window.M.define=="function"){window.M.define("jq-jgrowl",function(){return jQuery})}M.closure(function(e){var q=e("Storage"),b=1000,p=10000,r=40000,d=120000;$(function(){if(window.Env&&window.Env.UID>0||window.__mfw_uid>0){setTimeout(l,b)}else{setTimeout(j,p)}$("body").delegate(".jGrowl-closer","click",function(t){$.getJSON("/ajax/ajax_msg.php",{a:"closetip"});q.setItem("jgrowl_close_time",+new Date())});M.Event.on("update msg",function(){setTimeout(function(){s();q.setItem("update_msg",+new Date())},1)});q.on("update_msg",function(t){s()});function s(){if(window.Env&&window.Env.UID>0||window.__mfw_uid>0){n("msgdisplay")}else{n("nologinfeed")}}});function l(){setInterval(function(){M.windowFocused&&n("msgdisplay")},r)}function j(){var t,s=1;M.windowFocused&&n("nologinfeed");t=setInterval(function(){M.windowFocused&&n("nologinfeed");s++;if(s==3){clearInterval(t)}},d)}function n(s){$.get("/ajax/ajax_msg.php?a="+s,function(t){if(t){m(t)}},"json")}function m(s){g();M.Event.fire("get new msg",s);if(s.msg){k()}if(s.tips&&!i()){a(s)}}e("jq-jgrowl");function a(s){var t=s.tips.split(s.split_char);M.forEach(t,function(v,u){if(v){setTimeout(function(){$.jGrowl(v,{header:"æ–°é²œäº‹ï¼š",closer:false,life:20000})},2000*u+10)}})}function i(){var t=q.getItem("jgrowl_close_time"),s=+new Date();if(t&&s-t<24*60*60*1000){return true}return false}var c,f=0,h=1000,o=document.title;function k(){g();c=setInterval(function(){f++;document.title=f%2===0?"ã€ã€€ã€€ã€€ã€‘ - "+o:"ã€æ–°æ¶ˆæ¯ã€‘ - "+o},h)}function g(){clearInterval(c);document.title=o}});M.define("dialog/Layer",function(a){var g=0,f=550,d=(function(){return $.browser&&$.browser.msie&&parseInt($.browser.version,10)==7}()),c=(function(){return $.browser&&$.browser.msie&&parseInt($.browser.version,10)<7}());function b(){return g++}function e(h){this.opacity=0.8;this.background="#fff";this.impl="Dialog";this.fixed=true;M.mix(this,h);this.id="_j_layer_"+b();this.stacks=[];this.activeStackId=null;this.overflow=false;this.changeFixed=false;e.instances[this.id]=this;if(!e[this.impl]){e[this.impl]=[]}e[this.impl].push(this.id);this.init()}e.prototype={init:function(){this._createPanel()},_createPanel:function(){f++;var h={position:(!c&&this.fixed)?"fixed":"absolute",width:"100%",height:"100%",top:0,left:0},j=M.mix({},h,{"z-index":f,display:"none"}),k=M.mix({},h,{position:!c?"fixed":"absolute",background:this.background,opacity:this.opacity,"z-index":-1}),i=M.mix({},h,{"z-index":0},(!c&&this.fixed)?{"overflow-x":"hidden","overflow-y":"hidden"}:{overflow:"visible"});this._panel=$('<div id="'+this.id+'" class="layer _j_layer">                                <div class="layer_mask _j_mask"></div>                                <div class="layer_content _j_content"></div>                            </div>').css(j).appendTo("body");this._mask=this._panel.children("._j_mask").css(k);this._content=this._panel.children("._j_content").css(i)},setZIndex:function(h){f=h;this._panel.css("z-index",f)},getZIndex:function(){return +this._panel.css("z-index")},toFront:function(){this.setZIndex(f+1)},setFixed:function(h){h=!!h;if(this.fixed!=h){this.changeFixed=true;this.fixed=h;if(!c&&this.fixed){this._panel.css("position","fixed");this._content.css({position:"fixed","overflow-x":"hidden","overflow-y":"hidden"})}else{this._panel.css("position","absolute");this._content.css({position:"absolute","overflow-x":"","overflow-y":"",overflow:"visible"})}}else{this.changeFixed=false}},newStack:function(i){var h=$(i).appendTo(this._content);this.stacks.push(h);return this.stacks.length-1},getStack:function(h){return this.stacks[h]},getActiveStack:function(){return this.stacks[this.activeStackId]},setActiveStack:function(h){this.activeStackId=h},getPanel:function(){return this._panel},getMask:function(){return this._mask},getContent:function(){return this._content},show:function(j){var i=this;if(this.visible){typeof j==="function"&&j();return}e.activeId=this.id;this.visible=true;if(c){var h=document.documentElement&&document.documentElement.scrollHeight||document.body.scrollHeight;this._panel.css("height",h);this._mask.css("height",h)}this._panel.fadeIn(200,function(){typeof j==="function"&&j()})},hide:function(i){var h=this;if(!this.visible){typeof i==="function"&&i();return}this.visible=false;if(c){this._panel.css("height","");this._mask.css("height","")}this._panel.fadeOut(200,function(){typeof i==="function"&&i();h._recoverTopScroller()})},setOverFlow:function(h){this.overflow=h;if(h){if(!c&&this.fixed){this._hideTopScroller();this._content.css("overflow-y","auto")}}else{if(!c&&this.fixed){this._content.css("overflow-y","hidden")}}},_hideTopScroller:function(){if(d){$("html").css("overflow","hidden")}else{if(!c){$("body").css("overflow","hidden")}else{$("body").css("overflow-x","hidden");this._panel.height($(document).height()+20)}}},_recoverTopScroller:function(){if(d){$("html").css("overflow","")}else{if(!c){$("body").css("overflow","")}else{$("body").css("overflow-x","")}}},destroy:function(){this.hide($.proxy(function(){this._panel&&this._panel.remove();this._panel=null;if(M.indexOf(e[this.impl],this.id)!=-1){e[this.impl].splice(M.indexOf(e[this.impl],this.id),1)}delete e.instances[this.id]},this))},clear:function(){this._content.empty();this.stacks=[];this.activeStackId=null}};e.instances={};e.activeId=null;e.getInstance=function(h){return e.instances[h]};e.getActive=function(h){var i=e.getInstance(e.activeId);if(h&&i){i=i.impl===h?i:null}return i};e.getImplInstance=function(i){var h=e.getActive(i);if(!h&&M.is(e[i],"Array")&&e[i].length){h=e.getInstance(e[i][e[i].length-1])}return h};e.closeActive=function(){var h=e.getActive();if(h&&h.getActiveStack()){h.getActiveStack().trigger("close")}};$(document).keyup(function(h){if(h.keyCode==27){e.closeActive()}});$(document).unload(function(){M.forEach(e.instances,function(){e.destroy()})});return e});M.define("dialog/DialogBase",function(b){var e=b("dialog/Layer"),a=M.Event,d=(function(){return $.browser&&$.browser.msie&&parseInt($.browser.version,10)<7}());function c(f){this.newLayer=false;this.width="";this.height="";this.background="#000";this.panelBackground="#fff";this.bgOpacity=0.7;this.stackable=true;this.fixed=true;this.reposition=false;this.autoPosition=true;this.minTopOffset=20;this.layerZIndex=-1;this.impl="Dialog";M.mix(this,f);this.visible=false;this.destroyed=false;this.positioned=false;this.resizeTimer=0;this.init()}c.prototype={tpl:"<div />",init:function(){this._createDialog();this._bindEvents()},_createDialog:function(){this._panel=$(this.tpl).css({position:"absolute",opacity:0,display:"none",background:this.panelBackground,"z-index":0});this.setRect({width:this.width,height:this.height});this._layer=!this.newLayer&&e.getImplInstance(this.impl)||new e({impl:this.impl});if(this.layerZIndex>=0){this._layer.setZIndex(this.layerZIndex)}this._layer.setFixed(this.fixed);this._layer.getMask().css({background:this.background,opacity:this.bgOpacity});this._stackId=this._layer.newStack(this._panel);this.setPanelContent()},_bindEvents:function(){var f=this;$(window).resize($.proxy(this.resizePosition,this));M.Event(this).on("resize",$.proxy(this.resizePosition,this));this._panel.delegate("._j_close, a[data-dialog-button]","click",function(g){var h=$(g.currentTarget).attr("data-dialog-button");if(h=="hide"){f.hide()}else{f.close()}g.preventDefault()});this._panel.bind("close",function(g,h){f.close(h)})},resizePosition:function(){var f=this;clearTimeout(this.resizeTimer);if(f.visible&&f.autoPosition){this.resizeTimer=setTimeout(function(){f.setPosition()},100)}},addClass:function(f){this._panel.addClass(f)},removeClass:function(f){this._panel.removeClass(f)},setRect:function(f){if(f.width){this._panel.css("width",f.width);this.width=f.width}if(f.height){this._panel.css("height",f.height);this.height=f.height}},getPanel:function(){return this._panel},getLayer:function(){return this._layer},getMask:function(){return this._layer&&this._layer.getMask()},setPanelContent:function(){},_getPanelRect:function(){var f=this.getPanel(),g=f.outerHeight(),h=f.outerWidth();if(!f.is(":visible")){f.css({visibility:"hidden",display:"block"});var g=f.outerHeight(),h=f.outerWidth();f.css({visibility:"",display:""})}return{height:g,width:h}},_getNumric:function(f){f=parseInt(f,10);return isNaN(f)?0:f},setPosition:function(f){var g=this._getPanelRect(),h={width:$(window).width(),height:$(window).height()};var k=(h.width-(this._getNumric(this.width)>0?this._getNumric(this.width):g.width))/2,j=(h.height-(this._getNumric(this.height)>0?this._getNumric(this.height):g.height))*4/9;j=j<this.minTopOffset?this.minTopOffset:j;if(d||!this.fixed){var i=$(window).scrollTop();if(i>0){j+=i}}f={left:(f&&f.left)||k,top:(f&&f.top)||j};if(!d&&this.fixed){if(h.height-g.height<=f.top){this.getPanel().addClass("dialog_overflow");this._layer.setOverFlow(true)}else{this.getPanel().removeClass("dialog_overflow");this._layer.setOverFlow(false)}}var l=this.positioned?"animate":"css";$.fn[l].call(this.getPanel(),f,200);this.positioned=true;this.position=f},setFixed:function(f){this.fixed=!!f;this._layer.setFixed(this.fixed)},getPosition:function(){return this.position},show:function(f){if(this.visible){return}var h=this;a(this).fire("beforeshow");var g;if(this._layer.getActiveStack()){g=this._layer.getActiveStack();if(!this.reposition&&!f&&!this._layer.changeFixed){f=this._layer.getActiveStack().position()}}this._layer.show();this.getPanel().css({display:"","z-index":1});this.setPosition(f);g&&g.trigger("close",[true]);this.visible=true;this._layer.setActiveStack(this._stackId);this.getPanel().animate({opacity:1},{queue:false,duration:200,complete:function(){a(h).fire("aftershow")}})},close:function(){var f=this.stackable?"hide":"destroy";this[f].apply(this,Array.prototype.slice.call(arguments))},hide:function(g,f){if(typeof g=="function"){f=g;g=undefined}if(!this.visible){typeof f=="function"&&f();return}a(this).fire("beforeclose");a(this).fire("beforehide");this._layer.setActiveStack(null);this.visible=false;if(!g){this._layer.hide()}this.getPanel().animate({opacity:0},{queue:false,duration:200,complete:$.proxy(function(){this.getPanel().css({display:"none","z-index":0});a(this).fire("afterhide");a(this).fire("afterclose");typeof f=="function"&&f()},this)})},destroy:function(g,f){if(typeof g=="function"){f=g;g=undefined}if(this.destroyed){M.error("Dialog already destroyed!");typeof f=="function"&&f();return}a(this).fire("beforeclose");a(this).fire("beforedestroy");this.destroyed=true;this.hide(g,$.proxy(function(){if(this._panel.length){this._panel.undelegate();this._panel.unbind();this._panel.remove();this._panel=null}this._layer=null;a(this).fire("afterdestroy");a(this).fire("afterclose");typeof f=="function"&&f()},this))}};return c});M.define("dialog/Dialog",function(c){var d=c("dialog/DialogBase"),a='<div class="popup-box layer_dialog _j_dialog pop_no_margin">                    <div class="dialog_title" style="display:none"><div class="_j_title title"></div></div>                    <div class="dialog_body _j_content"></div>                    <a id="popup_close" class="close-btn _j_close"><i></i></a>                </div>';var b=M.extend(function(e){this.content="";this.title="";this.PANEL_CLASS="";this.MASK_CLASS="";b.$parent.call(this,e)},d);M.mix(b.prototype,{tpl:a,setPanelContent:function(){this._dialogTitle=this._panel.find("._j_title");this._dialogContent=this._panel.find("._j_content");this.setTitle(this.title);this.setContent(this.content);this.addClass(this.PANEL_CLASS);this.getMask().addClass(this.MASK_CLASS)},setTitle:function(e){if(e){this._dialogTitle.html(e).parent().css("display","")}else{this._dialogTitle.parent().css("display","none")}this.title=e},getTitle:function(){return this.title},setContent:function(e){this._dialogContent.empty().append(e)}});return b});M.define("FrequencyVerifyControl",function(c,b,d){function a(e){this.container=e.container;this.app=e.app;this.successHandler=$.noop;M.mix(this,e);this.init()}a.prototype={init:function(){this.initData();this.refreshImg();this.verifyCon.delegate("img,._j_change_img","click",$.proxy(function(e){this.refreshImg()},this));this.verifyCon.delegate("._j_fre_confirm","click",$.proxy(function(h){var g=this.verifyText.val();var f=g.length;if(f==0){this.showErro("æ‚¨è¿˜æ²¡æœ‰è¾“å…¥éªŒè¯ç !");return false}else{if(f!==6){this.showErro("è¯·è¾“å…¥æ­£ç¡®çš„éªŒè¯ç !");return false}}var e=$(h.currentTarget);if(e.hasClass("waiting")){return false}e.addClass("waiting");$.post("/user/captcha/verify",{sCode:g,iApp:this.app},$.proxy(function(i){if(i){if(i.ret===1){this.successHandler(this.target);this.verifyCon.hide();this.hideErro()}else{if(i.ret===0){this.verifyText.val("");this.verifyText.focus();this.refreshImg();this.showErro("è¾“å…¥çš„éªŒè¯ç ä¸æ­£ç¡®!")}else{if(i.ret===-1){this.showErro("é”™è¯¯æ¬¡æ•°è¿‡å¤šï¼Œè¯·ç¨å€™å°è¯•")}}}}e.removeClass("waiting")},this),"json")},this));this.verifyCon.delegate("._j_fre_text","keyup",$.proxy(function(e){if(e.keyCode==13){this.verifyCon.find("._j_fre_confirm").trigger("click")}},this))},showErro:function(e){this.errorCon.html(e);this.errorCon.show()},hideErro:function(){this.errorCon.hide()},initData:function(){this.verifyCon=this.container;this.verifyPo=this.verifyCon.find(".protectedYZM");this.verifyImg=this.verifyCon.find("img");this.verifyText=this.verifyCon.find("._j_fre_text");this.errorCon=this.verifyPo.find(".n-error")},refreshImg:function(){var e="/user/captcha/code?iApp="+this.app+"&s="+new Date().getTime();this.verifyImg.attr("src",e)}};d.exports=a});M.define("FrequencySystemVerify",function(f,e,g){var b=f("dialog/Dialog"),h=f("dialog/Layer"),d=f("FrequencyVerifyControl");var a='<div class="popYzm" style="z-index:inherit;position: relative;width:350px;height: 250px"><div class="protectedYZM" style="border: none;box-shadow: none;padding:25px 15px;"><p>äº²çˆ±çš„èœ‚èœ‚ï¼Œä½ æ“ä½œçš„é€Ÿåº¦æœ‰ç‚¹åƒæœºå™¨äºº<br>æ¥è¯æ˜Žä¸‹è‡ªå·±å§~</p><div class="YZMInput"><input class="_j_fre_text" type="text" placeHolder="éªŒè¯ç "></div><div class="YZMInput"><img src="http://images.mafengwo.net/images/home_new2015/verify.gif" width="150px" height="40px"><label><a href="javascript:void(0);" class="_j_change_img">çœ‹ä¸æ¸…ï¼Œæ¢ä¸€å¼ </a></label></div><div class="YZMSubmit"><a href="javascript:void(0);" class="_j_fre_confirm" title="ç¡®å®š">ç¡®å®š</a><span class="n-error">é”™è¯¯æ¬¡æ•°è¿‡å¤šï¼Œè¯·ç¨å€™å°è¯•</span></div></div></div>';function c(i){this.app=i.app;this.init()}c.prototype={init:function(){var i=new b({content:a});if(h.getActive()){i.getLayer().setZIndex(h.getActive().getZIndex()+1)}i.show();var j=i.getPanel().find(".popYzm");new d({container:j,app:this.app,successHandler:$.proxy(function(){M.Event.fire("frequency:system:verify:success");i.close()},this)})}};g.exports=c});M.closure(function(d){var b=d("dialog/Dialog"),c=d("FrequencySystemVerify");window.show_login=a;$.ajaxSetup({dataFilter:function(h,g){try{var j=$.parseJSON(h);if(j&&j.unsafe==1){window.location.href="http://www.mafengwo.cn";return"{}"}if(j&&j.error&&j.error.msg=="login:required"){M.Event.fire("login:required");return"{}"}if(j&&j.resource&&j.resource.onload&&j.resource.onload.length){if(j.resource.onload[0]=='K.fire("login:required");'){M.Event.fire("login:required");return"{}"}}if(j&&j.error){var f=0;var k=0;if(typeof(j.error.errno)!=="undefined"){f=j.error.errno;k=j.error.error}else{if(typeof(j.error.code)!=="undefined"){f=j.error.code;k=j.error.msg}}if(f===10000){M.Event.fire("frequency:verify",k);return"{}"}}}catch(i){}return h}});var e=null;function a(){if($.browser.msie&&parseInt($.browser.version,10)<9){document.location.href=(window.Env&&window.Env.P_HTTP)||"https://passport.mafengwo.cn";return}if(!e){e=new b({PANEL_CLASS:"login_pop",content:'<iframe frameborder="no" border="0" scrolling="no" width="580" height="292" allowtransparency="true"></iframe>',background:"#aaa",bgOpacity:0.6,reposition:true,impl:"logindialog"})}e.show();if(!e.getPanel().find("iframe").attr("src")){M.Event(e).once("aftershow",function(){var f=window.Env.P_HTTP||"https://passport.mafengwo.cn";e.getPanel().find("iframe").attr("src",f+"/login-popup.html")})}}M.Event.on("login:required",a);M.Event.on("frequency:verify",function(f){new c({app:f})});if(M.Event.isFired("login:required")){a()}});M.define("ScrollObserver",function(e,g,c){var h=0,f={},a=false,b,d=true;g.addObserver=function(k){var j="ScrollObserver_"+h;h++;f[j]=k;d=false;return j};g.removeObserver=function(j){delete f[j];if(M.isEmpty(f)){d=true}};function i(){for(var j in f){if(f.hasOwnProperty(j)){f[j]()}}}$(window).scroll(function(){if(d){return}if(!a){b=setInterval(function(){if(a){a=false;clearTimeout(b);i()}},50)}a=true});return g});M.define("QRCode",function(b,a,c){c.exports={gen:function(e,d){var d={text:e,size:d.size||200,eclevel:d.evlevel||"H",logo:d.logo||"",__stk__:window.Env.CSTK};return"http://"+window.Env.WWW_HOST+"/qrcode.php?"+$.param(d)}}});M.closure(function(b){var l=b("ScrollObserver"),m=b("Storage"),d=window.Env||{},f=$("#_j_mfwtoolbar"),h=f.height(),a=$(window).height(),k=$(document).height(),g=$("#footer"),e=g.outerHeight();$("body").css("position","relative");$(window).resize(function(){a=$(window).height();k=$(document).height()});setInterval(function(){var n=$(document).height();if(n!=k){k=n;$(window).trigger("scroll")}},2000);if(!d.hideToolbar){if(!d.showToolbarDownArrow){f.children(".toolbar-item-down").remove()}else{f.children(".toolbar-item-down").show()}f.show();c();l.addObserver(c);f.on("click","._j_gotop",i);f.on("click","._j_gobottom",j);f.children(".toolbar-item-code").mouseenter(function(){$(this).addClass("hover")});f.children(".toolbar-item-code").mouseleave(function(){$(this).removeClass("hover")})}function c(){var n=$(window).scrollTop();if(n>500){f.children(".toolbar-item-top").show()}else{f.children(".toolbar-item-top").hide()}if(g.length){if(n+a>g.offset().top){f.css({position:"absolute",bottom:e+20})}else{f.css({position:"",bottom:""})}}}function i(){$("html, body").animate({scrollTop:0},500,function(){M.Event.fire("scroll to top")})}function j(){$("html, body").animate({scrollTop:k-a},500,function(){M.Event.fire("scroll to bottom")})}});(function(){var a=document.createElement("script"),b=window.Env&&window.Env.CNZZID||30065558;a.type="text/javascript";a.async=true;a.charset="utf-8";a.src=document.location.protocol+"//w.cnzz.com/c.php?id="+b+"&async=1";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(a,c)})();M.closure(function(a){M.log("åªè¦ä½ æœ‰æ¢¦æƒ³ï¼Œå°±åŠ å…¥æˆ‘ä»¬\nä½ å³å°†è§è¯äº’è”ç½‘æœ€æ–°è¶‹åŠ¿çš„å¿«é€Ÿæˆé•¿\nèš‚èœ‚çªçš„ä¸€åˆ‡èµ„æºéƒ½ä¼šæˆä¸ºä½ æˆé•¿è·¯ä¸Šçš„æœ€å¤§åŠ©åŠ›\nä½ å¯ä»¥å’Œèš‚èœ‚çªä¸€èµ·ä¹¦å†™äº’è”ç½‘çš„é£Žäº‘å¥‡è¿¹\nåœ¨è¿™é‡Œæœ‰ä¸€ç¾¤å’Œä½ ä¸€æ ·ï¼Œç–¯ç‹‚åœ°çƒ­çˆ±äº’è”ç½‘å’Œæ—…è¡Œçš„äººä»¬\nèš‚èœ‚çªèƒ½ä¸ºä½ å®žçŽ°æ¢¦æƒ³æä¾›æœ€å¹¿é˜”çš„å¹³å°");M.log("è¯·å°†ç®€åŽ†å‘é€è‡³ %csuperhr@mafengwo.com%cï¼ˆ é‚®ä»¶æ ‡é¢˜è¯·ä»¥â€œ_consoleâ€ç»“å°¾ï¼‰","color:#4ae;","color:inherit;");M.log("èŒä½ä»‹ç»ï¼šhttp://www.mafengwo.cn/s/hr.html")});M.closure(function(a){$.get("/ajax/ajax_page_onload.php",{href:document.location.href,_t:+new Date()},function(b){if(b.payload&&b.payload.apps){var c=b.payload.apps;if(!M.isEmpty(c)){var d={css_list:c.css||[]};M.loadCssJsListSeq(d,function(){if(c.html){$("body").append(c.html)}if(c.js&&c.js.length){M.loadResource(c.js)}})}}},"json")});